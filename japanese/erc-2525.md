---
original: f42f6af520bbf539ca429bcbc6611cd0aaffc41881471f5b329611e0549858da
---

---
eip: 2525
title: ENSLogin
author: Hadrien Croubois (@amxx)
discussions-to: https://ethereum-magicians.org/t/discussion-ens-login/3569
status: Stagnant
type: Standards Track
category: ERC
created: 2020-02-19
requires: 137, 634, 1193, 2304
---

## 1. 概要

これは、ENSが提供するメタデータストレージを活用して、Ethereumブロックチェーンへのユニバーサルなログイン方法を改善する方法を提示するものです。ユーザーがログインしていると見なされるのは、[EIP-1193](./eip-1193.md)準拠のプロバイダーが、ユーザーに代わってトランザクションやメッセージに署名できる場合です。この方法は、[Alex Van de Sande氏の研究](https://www.youtube.com/watch?v=1LVwWknE-NQ)と[Web3Connect](https://web3connect.com)に着想を得ています。将来的には、ここで説明する手法を、あらゆるブロックチェーンで使えるよう拡張していくべきです。

## 2. 動機

Ethereumブロックチェーンとやり取りするには、さまざまなウォレットソリューションが使えます。一部のウォレット(Metamask、Gnosis、など)は、ブラウザにウォレットオブジェクトを注入することで、Dappデベロッパーの手間なしにユーザーと連携できますが、ユーザー側で手間がかかります(プラグインをインストールする必要があります)。一方、Portis、Authereum、Torus、Universal Loginなどのその他のソリューションは、暗号通貨に詳しくないユーザーにもシームレスな体験を提供しますが、Dappデベロッパーの統合作業が必要です。ハードウェアウォレット(Ledger、Trezor、KeepKey、など)も、Dappデベロッパーの統合作業が必要です。

Dappがログインに複数のソリューションを統合する場合、ユーザーが正しいウォレットプロバイダーを選択する必要があります。ウォレットプロバイダーの数が増えるにつれ、特に初心者ユーザーにとって、これが困難になる可能性があります。さらに、分散型アプリケーションが一部のウォレットしか対応しない場合、現在主流のウォレットが有利な立場になり、新しいウォレットの普及が阻害される可能性があります。これにより、競争環境が悪化し、イノベーションが阻害される恐れがあります。Web3Connectのように、ユーザーがどのウォレットプロバイダーに接続するかを選択するのではなく、ENSLoginでは、ユーザー所有のENSドメインをエントリーポイントとして使用することを提案しています。これらのENSドメインに添付されたメタデータを使って、対応するアカウントが使用しているウォレットプロバイダーを検出します。

このようにENSLoginを使えば、ユーザーは簡単なドメイン名を使って、任意のDappに任意のウォレットで接続できるようになります。

## 3. 説明

### 3.1. 概要

ENSLoginの動作は以下の通りです:

* ユーザーにENSドメインを要求する
* ENSドメインを解決して、以下の情報を取得する(see [EIP-137](./eip-137.md))
	* アドレス(see [EIP-137](./eip-137.md))
	* テキストエントリー(see [EIP-634](./eip-634.md))
* テキストエントリーを解釈し、そこで指定されたファイルをダウンロードする
* ダウンロードしたファイルの内容を評価する
* 対応するオブジェクトをDappに返す

この時点で、Dappは通常のWeb3プロバイダーと同様に処理を行います。`enable()`関数を呼び出すと、必要に応じてユーザーにウォレット固有の認証情報を要求します。

このワークフローは、Dappが簡単にインポートできるSDKによって実装されます。SDKには、解決メカニズムと、集中型および分散型のストレージソリューションのサポートが含まれます。ウォレットプロバイダー固有のコードはSDKの一部ではなく、Web3プロバイダーを生成するために使用される外部ファイルにのみ存在します。

### 3.2. 詳細

* **テキストエントリーの解決:** ウォレットプロバイダーをインスタンス化するためのコードへのポインターは、ENSのテキストエントリーサポート(see [EIP-634](./eip-634.md))を使って記録されます。対応するキーは`enslogin`(**変更される可能性があります**)です。ターゲットのドメインに`enslogin`キーの値がない場合は、親ノードのメタデータに`enslogin-default`(**変更される可能性があります**)キーの値をフォールバックします。
**例:** `username.domain.eth`というENSドメインの場合、解決は以下の順で行われます:
	* `resolver.at(ens.owner(nodehash("username.domain.eth"))).text(nodehash("username.domain.eth"), 'enslogin')`
	* `resolver.at(ens.owner(nodehash("domain.eth"))).text(nodehash("domain.eth"), 'enslogin-default')`

* **プロバイダーのリンク:** ウォレットプロバイダーをインスタンス化するためのコードは、標準化された方法でポイントされる必要があります。**これはまだ指定されていません。** 現在の方法では、人間が読めるフォーマット `scheme://path` を使用しています:

	* `ipfs://Qm12345678901234567890123456789012345678901234`
	* `https://server.com/enslogin-module-someprovider`

	そして、対象のブロックチェーンの種類(see [SLIP 44](https://github.com/satoshilabs/slips/blob/master/slip-0044.md))と言語に応じて、接尾辞を追加します。Ethereumを使うWebアプリの場合の正規形は以下のようになります:

	* `ipfs://Qm12345678901234567890123456789012345678901234/60/js`
	* `https://server.com/enslogin-module-someprovider/60/js`

	この接尾辞メカニズムは、http/httpsとIPFSの両方に対応しています。ストレージ層の制約として、この種の解決ができない場合もあります。

* **プロバイダーのインスタンス化:**
	* [JAVASCRIPT/ETHEREUM] ウォレットプロバイダーのコードを含むファイルは、`global.provider: (config) => Promise<web3provider>`という関数をインジェクトする必要があります。この関数は、標準化されたプロバイダーオブジェクトを返すPromiseを返します。EVMブロックチェーンの場合、そのオブジェクトは[EIP-1193](./eip-1193.md)に準拠する必要があります。
	* 他のブロックチェーンの種類/言語については、今後詳細を記述する必要があります。

* **設定オブジェクト:** ユーザー名(ENSドメイン)に加えて、Dappはウォレットプロバイダーのインスタンス化関数に渡す設定オブジェクトを持つ必要があります。この設定には以下が含まれます:
	* すべてのプロバイダーに共通の本体部分(ターゲットのチェーンの詳細(ネットワーク名/ノード、ENSエントリーポイントのアドレスなど)を指定)。これらのいずれかが欠落している場合は、フォールバックを使用できます(デフォルトのメインネット、ブラウザ内のIPFSノードの起動など)。
	* ウォレットプロバイダー固有のフィールド(**オプション**、先頭に1つのアンダースコア `_` を付ける)を追加して、追加のパラメーターやデバッグフラグを渡すことができます。
	* SDK固有のフィールド(**オプション**、先頭に2つのアンダースコア `__` を付ける)を使って、追加の引数を渡すことができます。

	最小限の設定:
	```
	{
		provider: {
			network: 'goerli'
		}
	}
	```
	高度な設定オブジェクトの例:
	```
	{
		provider: {
			network: 'goerli',
			ens:     '0x112234455c3a32fd11230c42e7bccd4a84e02010'
		},
		ipfs: {
			host: 'ipfs.infura.io',
			port: 5001,
			protocol: 'https'
		},
		_authereum: {...},
		_portis: {...},
		_unilogin: {...},
		_torus: {...},
		__callbacks: {
			resolved: (username, addr, descr) => {
				console.log(`[CALLBACKS] resolved: ${username} ${addr} ${descr}`);
			},
			loading: (protocol, path) => {
				console.log(`[CALLBACKS] loading: ${protocol} ${path}`);
			},
			loaded: (protocol, path) => {
				console.log(`[CALLBACKS] loaded: ${protocol} ${path}`);
			}
		}
	}
	```

**TODO** *(maybe move that part to section 6.1)*:
[SLIP 44](https://github.com/satoshilabs/slips/blob/master/slip-0044.md)準拠のブロックチェーン記述を設定に追加して、マルチチェーンサポートを強化する。これには、解決時にどのEthereumネットワークを使うかを知るための追加フィールド `ENSネットワーク` が必要になる(Ethereum以外のブロックチェーン/ネットワークの場合に使用できるほか、Ethereum内でのクロスチェーン解決(例: xDAIログインでメインネットのメタデータを使用)にも使える)

### 3.3. 分散化

Web3Connectのようなソリューションとは異なり、ENSLoginは本質的に分散化されたアプローチを提案しています。
ENSLoginを使うDappが使うコード(以下、SDKと呼ぶ)は、Ethereumブロックチェーンの検索メカニズムとデータストレージソリューションのみを含んでいます。この解決策は、SDKが対話できるプロトコル(https / ipfs / ...)によって制限されます。それ以外では、期待される構造に従い、サポートされるプロトコルのいずれかで利用可能なウォレットプロバイダーは、すべてのENSLogin対応Dappと自動的に互換性があります。中央集権的な承認プロセスは必要ありません。さらに、デプロイ済みのSDKを更新する必要はなく、最新のウォレット更新を利用できます。プロトコルの許可された部分は、ユーザーがENSでコントロールするメタデータ(ウォレットプロバイダーの実装を記述する)のみです。ユーザーはフォールバックメカニズムを使って、ウォレットプロバイダーに更新を任せることもできます。

### 3.4. インセンティブ

ENSLoginの最大の強みは、Dappデベロッパーとウォレットプロバイダーのインセンティブが、このスタンダードに沿うように整合していることだと考えています。

* 必要なファイルを実装し、利用可能にしたウォレットプロバイダーは、そのウォレットをENSLogin対応Dappすべてで使えるようにします。これにより、すべてのDappにソリューションを統合してもらう必要がなくなります。Dappはユーザーベースが十分に大きくなるまで、そのようなウォレットを統合する可能性は低いでしょう。その結果、ENSLoginはウォレットプロバイダー間の競争を促進し、その分野のイノベーションを奨励することになります。
* ENSLoginプロトコルを使うDappは、ENSLoginのSDKを含むか、互換性のある動作を実装することで、すべての互換ウォレットのユーザーにアクセスできるようになります。ある時点で、ENSLogin対応であることが、大規模なユーザーベースを獲得する最も簡単な方法になるでしょう。
* ENSLoginはほとんどユーザーに透過的です。ほとんどのウォレットプロバイダーが、ユーザーの手間なしに必要なエントリーを設定します。高度なユーザーは、適切なツールが利用できれば、ウォレットの解決プロセスを制御できます。

### 3.5. 欠点

ENSLoginにより、Dappはどのウォレットでもログインできるようになりますが、ユーザー登録に推奨するウォレットを選択する必要があります。これは、Web3ConnectやBlockNative'sのようなコンポーネントを使って行うことができます。

## 4. プロトタイプ

**TODO**

## 5. コミュニティによるサポート


### 5.1. 採用状況

| 名称           | 稼働中 | モジュール | ENS名の割り当て | デフォルトサポート |
| -------------- | ------ | ---------- | --------------- | ------------------ |
| Argent         | はい   | いいえ     | はい            | いいえ             |
| Authereum      | はい   | はい        | はい            | いいえ             |
| Fortmatic      | はい   | いいえ     | いいえ          | いいえ             |
| Gnosis Safe    | はい   | はい\*      | いいえ          | いいえ             |
| Ledger         | はい   | ベータ     | いいえ          | いいえ             |
| KeepKey        | はい   | いいえ     | いいえ          | いいえ             |
| Metamask       | はい   | はい        | いいえ          | いいえ             |
| Opera          | はい   | はい\*      | いいえ          | いいえ             |
| Portis         | はい   | はい        | いいえ          | いいえ             |
| SquareLink     | はい   | いいえ     | いいえ          | いいえ             |
| Shipl          | いいえ | いいえ     | いいえ          | いいえ             |
| Torus          | はい   | はい        | いいえ          | いいえ             |
| Trezor         | はい   | いいえ     | いいえ          | いいえ             |
| UniLogin       | ベータ | ベータ     | はい            | いいえ             |

\*Metamaskモジュールを使用

## 6. 可能な発展

### 6.1. マルチチェーンサポート

**TODO**

## 7. FAQ

### 7.1. 誰でもログインできるのですか? 秘密鍵はどこに保存されていますか?

ENSLoginは、ENSに記録されているアドレスとプロバイダーにしかアクセスできません。秘密鍵の管理は、プロバイダーが担当しており、ENSLoginの範疇外です。一部のプロバイダーはディスクに鍵を保存するかもしれません。他のプロバイダーは、リモートの(できるだけ安全な)サーバーに保管された管理鍵を使うかもしれません。ハードウェアコンポーネントを使って署名を処理し、秘密鍵に直接アクセスしないプロバイダーもあります。

### 7.2. ENSログインを取得するにはどうすればよいですか?

**TODO** (これには別のERCが必要かもしれません)