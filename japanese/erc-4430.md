---
original: 18499a711f984b57909e0ab45b15ba3887970e15258524c8556445f1cac5eacb
---

---
eip: 4430
title: 記述されたトランザクション
description: コントラクトがトランザクションの副作用について人間が読める説明を提供する手法。
author: Richard Moore (@ricmoo), Nick Johnson (@arachnid)
discussions-to: https://ethereum-magicians.org/t/discussion-eip-4430-described-transactions/8762
status: 停滞中
type: Standards Track
category: ERC
created: 2021-11-07
---

## 概要

コントラクトのメソッドを使って、機械可読のバイトコードと同時に人間が読める説明を生成することで、ユーザーがUIで人間が読める部分に同意し、機械が承認されたバイトコードを実行できるようにする*仮想関数*を提供します。

## 動機

Ethereum ウォレット(MetaMask、Clef、ハードウェアウォレットなど)を使う際、ユーザーはトランザクションを送信する前に承認する必要があります(あるいは拒否することもできます)。

Ethereum トランザクションの複雑さから、ウォレットはユーザーが承認しているトランザクションの影響について洞察を提供する能力が非常に限られています。ERC20 トランザクションなどの一般的なトランザクションを除いては、ユーザーに不透明なバイナリデータに署名させることが多いのが現状です。

このEIPは、dappの開発者がウォレットに対してトランザクションの説明をより良く生成する手段を提供することで、ユーザーエクスペリエンスを向上させる方法を提示します。

悪意のあるコントラクトが嘘をつくことに対処するものではありません。正直なコントラクトがユーザーの生活を良くしたいという合理的なセキュリティモデルのみを扱います。トランザクションの説明はコントラクトコードと同時に監査できるため、監査人やコードレビューアーがその正確性を確認できると考えています。

## 仕様

**description**（文字列）と一致する**execcode**（バイトコード）は、以下のメソッドを評価することで同時に生成されます:

```solidity
function eipXXXDescribe(bytes inputs, bytes32 reserved) view returns (string description, bytes execcode)
```

人間が読める**description**は、承認のためのユーザーインタラクションをサポートするクライアントで表示できます。一方、**execcode**はそのオペレーションを実行するためにコントラクトに送信するべきデータです。

このメソッドはスタティックコンテキストで実行可能でなければなりません(つまり、logX、sstore などの副作用は無視される可能性があります)。

評価中は、`ADDRESS`(つまり`to`)、`CALLER`(つまり`from`)、`VALUE`、`GASPRICE`が、説明しているトランザクションの値と同じでなければなりません。これにより、説明を生成するコードがそれらに依存できるようになります。

バイトコードを実行する際は、`BLOCKHASH`、`NUMBER`、`TIMESTAMP`、`DIFFICULTY`が`"latest"`ブロックと一致するよう最大限の努力をする必要があります。`COINBASE`はゼロアドレスでなければなりません。

メソッドはリバートする可能性があり、その場合は署名を中止する必要があります。

## 根拠

### メタ説明

この問題を解決しようとする多くの試みは、エンコードされたトランザクションデータやメッセージデータを直接調べようとしています。

多くの場合、意味のある説明に必要な情報は、最終的にエンコードされたトランザクションデータやメッセージデータには存在しません。

代わりに、このEIPはデータの間接的な説明を使用します。

例えば、ENSの`commit(bytes32)`メソッドはオンチェーンにコミットメント**ハッシュ**を置きます。ハッシュには**ブラインド化された**名前とアドレスが含まれています。名前がブラインド化されているため、エンコードされたデータ(つまりハッシュ)には元の値が含まれておらず、説明に必要な値にアクセスできなくなります。

代わりに、コミットメントを間接的に説明する(元の情報:名前、アドレス、シークレットを保持したまま)ことで、意味のある説明(例えば「シークレットを使って名前をアドレスにコミットする」)を計算し、一致するデータ(`commit(hash(name, owner, secret))`)を計算できます。

このブラインドデータの手法は、圧縮のためではなく、プライバシーのために、ブラインド化を使うL2ソリューションでもっと一般的になるでしょう。

### コントラクトアドレスの絡め込み

署名されたデータがコントラクト間で使用されるのを防ぐため、コントラクトアドレスはトランザクションの`to`フィールドを介して暗黙的に絡め込まれます。

### 代替案

- NatSpecなどはエンコードされたデータを直接記述しようとする複雑な言語のクラスです。言語の複雑さのため、大きなランタイム環境と十分な処理能力とメモリ、さらにセキュリティ上の懸念を軽減するための追加のサンドボックスが必要になることが多いです。このEIPの目的の1つは、ハードウェアウォレットやその他のシンプルなウォレットで実行できるような複雑さの低減です。これらはデータを直接記述しますが、多くの場合(ブラインドデータなど)、データを適切に記述できません。

- カスタム言語。Ethereumトランザクションの複雑さから、使用する言語には多くの表現力が必要で、最初から作り直す必要があります。EVMは既に存在しており(理想的ではないかもしれませんが)、必要なすべてを処理できます。

- フォーマット文字列(Trustless Signing UI Protocolなど)。フォーマット文字列は正規言語のクラスでしか動作できず、多くの場合Ethereumトランザクションを記述するには不十分です。これは、この問題を解決しようとした初期の試みでよく問題になっていました。

- signTypedData [EIP-712](./eip-712.md)は、このEIPが解決しようとしている問題と多くの共通点があります。

## 下位互換性

下位互換性に影響はありません。

## 参考実装

アドレスとチェーンIDによる展開済みの例を追加します。

## セキュリティ上の考慮事項

### テキストのエスケープ

ウォレットはコントラクトから提供されたテキストを表示する際、適切な対策を講じる必要があります。例えば以下のことに注意が必要です:

- HTMLがスクリプトタグに埋め込まれ、ウェブベースのウォレットがコードを実行しようとする(秘密鍵をサーバーにアップロードする)可能性があります。
- HTMLを描画する際は一般に極端な注意が必要です。ENSの名前`<span style="display:none">not-</span>ricmoo.eth`や`&thinsp;ricmoo.eth`のように、適切に処理されないと`ricmoo.eth`と表示されてしまうものがあります。
- 引用符(`"`), 書式設定(`\n`(改行), `\f`(フォームフィード), `\t`(タブ), その他多くの非標準的な空白文字)、バックスラッシュ(`\`)など、エスケープが必要な記号が含まれる可能性があります。
- UTF-8には過去にコード実行やレンダラークラッシュを引き起こすバグがありました。一般的なプレーンや部分集合外のコードポイントには、UTF-8の置換文字(または何か)を使用することを検討してください。
- 同音異義語攻撃
- 右から左への印が描画に影響する可能性があります。
- 環境によっては他にも多くの問題があります。

## 著作権

著作権およびそれに関連する権利は[CC0](../LICENSE.md)で放棄されています。