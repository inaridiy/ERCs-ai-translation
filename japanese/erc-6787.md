---
original: 8f408078e181c3c0549b9c7c496845569ad91453149e921eba571eea78410cb9
---

---
eip: 6787
title: 2フェーズ引き出しを備えたオーダーブックDEX
description: ユーザーとエクスチェンジの両方の資産セキュリティを確保するオーダーブックベースのDEXインターフェース
author: Jessica (@qizheng09)、Roy (@royshang)、Jun (@SniperUsopp)
discussions-to: https://ethereum-magicians.org/t/order-book-dex-standard/13573
status: Draft
type: Standards Track
category: ERC
created: 2023-03-27
---


## 概要

オーダーブックDEX標準は、オーダーブックを使ってアセットを取引するための分散型取引所(DEX)プロトコルのインターフェース仕様を定義する提案です。この標準は、ユーザーがDEXでアセットを預け入れ、引き出し、取引できるようにする一連の機能を提供します。さらに、ユーザーとエクスチェンジの両方の資産セキュリティを確保するための新しい2フェーズ引き出しスキームを提案しています。これにより、ユーザーがエクスチェンジを信頼できるようになります。

## 動機

近年、分散型取引所(DEX)が急速に普及しています。これは、ユーザーがより自分のアセットをコントロールでき、中央集権的な仲介者への依存を減らすことができるためです。しかし、多くの既存のDEXプロトコルは、流動性の低さや非効率な価格発見などの問題を抱えています。Layer2ベースのオーダーブックDEXが人気の代替案として登場していますが、そのような取引所を実装するための標準化されたインターフェースはまだありません。

オーダーブックDEX標準は、相互運用可能なオーダーブックDEXを構築するための共通インターフェースを開発者に提供することを目的としています。これにより、ネットワーク効果を活用できるようになります。預け入れ、引き出し、強制引き出しの各機能を標準化することで、オーダーブックDEX標準は、ユーザーのアセットセキュリティを完全に保証できます。同時に、2フェーズの強制引き出しメカニズムにより、ユーザーがエクスチェンジを標的とする悪意のある引き出しを防ぐこともできます。

2フェーズコミットプロトコルは重要な分散整合性プロトコルで、分散システムにおけるデータセキュリティと整合性を確保することを目的としています。Layer2オーダーブックDEXシステムでは、ユーザー体験を向上させ、金融セキュリティを確保するために、1:1の準備戦略と分散型のクリアリングおよび決済インターフェース、そして強制引き出し機能を採用しています。

しかし、このような設計にも潜在的なリスクがあります。ユーザーが永続的なコントラクト取引を行う場合、損失を被る可能性があります。このような状況で、悪意のあるユーザーが強制引き出し機能を悪用して損失を回避しようとする可能性があります。このような攻撃を防ぐために、2フェーズの強制引き出しメカニズムを提案しています。

2フェーズの強制引き出し機能を導入することで、ユーザーの金融セキュリティを保護しつつ、エクスチェンジの資産セキュリティも確保できます。第1フェーズでは、ユーザーの引き出し要求を事前に確認し、ユーザーのアカウント状況を確認します。第2フェーズでは、強制引き出しの検査期間の後、ユーザーが直接強制引き出しリクエストを提出して引き出しプロセスを完了できます。これにより、ユーザーが強制引き出し機能を悪用して損失を回避することを防ぐことができ、同時にエクスチェンジとユーザーの両方の資産セキュリティを確保できます。

結論として、2フェーズコミットプロトコルと2フェーズの強制引き出し機能を採用することで、分散システムにおけるデータの整合性とセキュリティを効果的に守りつつ、ユーザー体験と金融セキュリティも確保できます。

## 仕様

### インターフェース

オーダーブックDEX標準は以下のインターフェースを定義しています:

#### `deposit`

`function deposit(address token, uint256 amount) external;`

**deposit**関数は、ユーザーが特定のトークンの指定された量をエクスチェンジに預け入れることができます。*token*パラメーターはトークンコントラクトのアドレスを指定し、*amount*パラメーターは預け入れるトークンの量を指定します。

#### `withdraw`

`function withdraw(address token, uint256 amount) external;`

**withdraw**関数は、ユーザーが特定のトークンの指定された量をエクスチェンジから引き出すことができます。*token*パラメーターはトークンコントラクトのアドレスを指定し、*amount*パラメーターは引き出すトークンの量を指定します。

#### `prepareForceWithdraw`

`function prepareForceWithdraw(address token, uint256 amount) external returns (uint256 requestID);`

ユーザーが預け入れたアセットはエクスチェンジコントラクトのアカウントに保管され、エクスチェンジは1:1の準備を実証できます。**prepareForceWithdraw**関数は、ユーザーが特定のトークンの一定量の強制引き出しを開始するために使用されます。この関数は、ユーザーが強制引き出しを行いたいことを示し、デフォルトのタイムアウト期間後に引き出しを提出できます。タイムアウト期間中、エクスチェンジはユーザーの注文状況が期待どおりであることを確認し、ユーザーの悪意のある攻撃を避けるために、強制的に注文をキャンセルし、取引を決済する必要があります。この関数には以下のパラメーターが含まれます:

1. *token*: 引き出すトークンのアドレス
2. *amount*: 引き出すトークンの量

アカウントが並行して複数の2フェーズ強制引き出しを開始する可能性があるため、各強制引き出しには一意の*requestID*が必要です。この関数は、commitForceWithdraw関数を使用して強制引き出しを提出するために使用できる一意の*requestID*を返します。

#### `commitForceWithdraw`

`function commitForceWithdraw(uint256 requestID) external;`

1. *requestID*: 2フェーズ引き出しのリクエストID

**commitForceWithdraw**関数は、条件が満たされた後に強制引き出し操作を実行するために使用されます。この関数は*requestID*パラメーターを受け取り、これは prepareForceWithdraw 関数を使用して以前に開始された強制引き出しリクエストのIDを指定します。

### イベント

#### `PrepareForceWithdraw`

ユーザーが PrepareForceWithdraw を正常に呼び出したときに必ずトリガーされます。

`event PrepareForceWithdraw(address indexed user, address indexed tokenAddress, uint256 amount);`

## 根拠

2フェーズ引き出しのフローチャートを以下に示します:

![](../assets/eip-6787/image1.png)

## 下位互換性

下位互換性の問題はありません。

## セキュリティ上の考慮事項

議論が必要です。

## 著作権

著作権およびそれに関連する権利は[CC0](../LICENSE.md)で放棄されています。