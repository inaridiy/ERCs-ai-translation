---
original: 552a4d3fa5ec25b6db5c18b4ebe578442c513e06e0f033d6c9f03b553281fe6b
---

---
eip: 4361
title: Ethereum でのサインイン
description: Ethereum アカウントを使った、オフチェーンでの認証によるセッションの確立。
author: Wayne Chang (@wyc)、Gregory Rocco (@obstropolos)、Brantly Millegan (@brantlymillegan)、Nick Johnson (@Arachnid)、Oliver Terbu (@awoie)
discussions-to: https://ethereum-magicians.org/t/eip-4361-sign-in-with-ethereum/7263
status: レビュー中
type: Standards Track
category: ERC
created: 2021-10-11
requires: 55, 137, 155, 191, 1271, 1328
---

## 概要

Ethereum でのサインインは、スコープ、セッション詳細、セキュリティメカニズム(ノンス等)をパラメータとした標準メッセージフォーマットを使って、Ethereum アカウントがオフチェーンサービスを認証する方法を説明しています。この仕様の目的は、中央集権的なアイデンティティプロバイダーに代わる自己管理型の選択肢を提供し、Ethereum ベースの認証に関するオフチェーンサービス間の相互運用性を向上させ、ウォレットベンダーに一貫したマシンリーダブルなメッセージフォーマットを提供することで、ユーザーエクスペリエンスと同意管理の改善を図ることです。

## 動機

現在、ブロックチェーン以外のサービスにサインインする際、ユーザーは一般的に中央集権的なアイデンティティプロバイダー(IdP)を使います。これらのプロバイダーは、ユーザーの識別子に対する最終的な支配権を持つ中央集権的な主体です。例えば、大手インターネット企業やメールプロバイダーなどです。これらの当事者間のインセンティブは、しばしば一致していません。Ethereum でのサインインは、自身のデジタルアイデンティティに対してより多くの管理と責任を負いたいユーザーのための新しい自己管理型のオプションを提供します。

既に多くのサービスが、Ethereum アカウントを使ったメッセージ署名によるワークフローをサポートしています。例えば、認証アドレスに関する特権的なメタデータを管理するためのクッキーベースのWebセッションの確立などです。これは、サインインのワークフローを標準化し、既存のサービス間の相互運用性を向上させる機会であり、同時に、ウォレットベンダーにも、サインインリクエストを Ethereum でのサインインリクエストとして確実に識別できる方法を提供することで、ユーザーエクスペリエンスの改善につながります。

## 仕様

この文書における「MUST」、「MUST NOT」、「REQUIRED」、「SHALL」、「SHALL NOT」、「SHOULD」、「SHOULD NOT」、「RECOMMENDED」、「NOT RECOMMENDED」、「MAY」、「OPTIONAL」というキーワードは、RFC 2119 およびRFC 8174に記載されている通り解釈されるものとします。

### 概要

Ethereum でのサインイン(SIWE)は以下のように動作します:

1. 依存当事者(relying party)は SIWE メッセージを生成し、[ERC-191](./eip-191.md)で定義されている `\x19Ethereum Signed Message:\n<message length>` のプレフィックスを付加します。
2. ウォレットは、ユーザーに [ERC-191](./eip-191.md)の署名データフォーマットに従ったSIWEメッセージの構造化されたプレーンテキストメッセージ、または同等のインターフェイスを提示します。
3. 署名は依存当事者に提示され、署名の有効性とSIWEメッセージの内容が確認されます。
4. 依存当事者は、Ethereum ブロックチェーン(ENS、アカウントバランス、[ERC-20](./eip-20.md)/[ERC-721](./eip-721.md)/[ERC-1155](./eip-1155.md)資産の所有権など)や、許可されているかどうかに関わらず、その他のデータソースから Ethereum アドレスに関連するデータを取得する可能性があります。

### メッセージフォーマット

#### ABNF メッセージフォーマット

SIWE メッセージは、以下の拡張バッカス・ナウア記法(ABNF、RFC 5234)に準拠する必要があります(なお、`%s`は RFC 7405に従い、文字列用語の大文字小文字の区別を示します)。

```abnf
sign-in-with-ethereum =
    [ scheme "://" ] domain %s" wants you to sign in with your Ethereum account:" LF
    address LF
    LF
    [ statement LF ]
    LF
    %s"URI: " uri LF
    %s"Version: " version LF
    %s"Chain ID: " chain-id LF
    %s"Nonce: " nonce LF
    %s"Issued At: " issued-at
    [ LF %s"Expiration Time: " expiration-time ]
    [ LF %s"Not Before: " not-before ]
    [ LF %s"Request ID: " request-id ]
    [ LF %s"Resources:"
    resources ]

scheme = ALPHA *( ALPHA / DIGIT / "+" / "-" / "." )
    ; RFC 3986に完全に準拠した
    ; "scheme"の定義。

domain = authority
    ; RFC 3986より:
    ;     authority     = [ userinfo "@" ] host [ ":" port ]
    ; RFC 3986に完全に準拠した
    ; "authority"の定義。

address = "0x" 40*40HEXDIG
    ; EIP-55で指定された大文字小文字
    ; チェックサムエンコーディングにも
    ; 準拠する必要がある(EOAの場合)。

statement = *( reserved / unreserved / " " )
    ; RFC 3986の "reserved" と "unreserved"
    ; の定義を参照。
    ; LF(改行)を除外するためのものです。

uri = URI
    ; RFC 3986の "URI"の定義を参照。

version = "1"

chain-id = 1*DIGIT
    ; EIP-155の有効な CHAIN_ID を参照。

nonce = 8*( ALPHA / DIGIT )
    ; RFC 5234の "ALPHA" と "DIGIT"
    ; の定義を参照。

issued-at = date-time
expiration-time = date-time
not-before = date-time
    ; RFC 3339 (ISO 8601)の "date-time"
    ; の定義を参照。

request-id = *pchar
    ; RFC 3986の "pchar"の定義を参照。

resources = *( LF resource )

resource = "- " URI
```

#### メッセージフィールド

この仕様では、[ABNF メッセージフォーマット](#abnf-メッセージフォーマット)のルールに従ってSIWEメッセージから解析できる以下のフィールドを定義しています:

- `scheme` OPTIONAL. リクエストの発信元のURIスキーム。その値はRFC 3986のURIスキームに準拠する必要があります。
- `domain` REQUIRED. サインインをリクエストしているドメイン。その値はRFC 3986のauthorityに準拠する必要があります。authorityにはOPTIONALなポートが含まれます。ポートが指定されていない場合は、提供された`scheme`のデフォルトポートが想定されます(例えば、HTTPSの場合は443)。`scheme`が指定されていない場合は、デフォルトでHTTPSが想定されます。
- `address` REQUIRED. 署名を行うEthereumアドレス。その値は[ERC-55](./eip-55.md)で指定された大文字小文字チェックサムアドレスエンコーディングに準拠する必要があります。
- `statement` OPTIONAL. ユーザーが署名する人間が読める ASCII アサーション。`'\n'`(バイト `0x0a`)を含んではいけません。
- `uri` REQUIRED. 署名の対象となるリソースを示すRFC 3986 URI。
- `version` REQUIRED. 現在のSIWEメッセージのバージョン。この仕様では `1` でなければなりません。
- `chain-id` REQUIRED. セッションがバインドされている[EIP-155](./eip-155.md)チェーンID、およびコントラクトアカウントが解決されるネットワーク。
- `nonce` REQUIRED. 通常依存当事者によって選択され、リプレイ攻撃を防ぐために使用される、少なくとも8文字のランダムな文字列。
- `issued-at` REQUIRED. メッセージが生成された時刻(通常は現在時刻)。ISO 8601 datetime 形式の値でなければなりません。
- `expiration-time` OPTIONAL. 署名された認証メッセージが無効になる時刻。ISO 8601 datetime 形式の値でなければなりません。
- `not-before` OPTIONAL. 署名された認証メッセージが有効になる時刻。ISO 8601 datetime 形式の値でなければなりません。
- `request-id` OPTIONAL. サインインリクエストを一意に参照するために使用できるシステム固有の識別子。
- `resources` OPTIONAL. ユーザーが認証の一環として依存当事者によって解決されることを希望する情報や情報への参照のリスト。各リソースは `"\n- "` で区切られたRFC 3986 URIでなければなりません。ここで `\n` はバイト `0x0a` です。

#### 簡易メッセージテンプレート

可読性と理解の容易さのために、以下にBash風の簡易的なSIWEメッセージテンプレートを示します。このテンプレートはフィールドの省略可能性を反映していません。フィールドの説明は次のセクションで提供されます。完全なABNF記述は[ABNF メッセージフォーマット](#abnf-メッセージフォーマット)にあります。

```
${scheme}:// ${domain} wants you to sign in with your Ethereum account:
${address}

${statement}

URI: ${uri}
Version: ${version}
Chain ID: ${chain-id}
Nonce: ${nonce}
Issued At: ${issued-at}
Expiration Time: ${expiration-time}
Not Before: ${not-before}
Request ID: ${request-id}
Resources:
- ${resources[0]}
- ${resources[1]}
...
- ${resources[n]}
```

#### 例

以下は、暗黙的なスキームを持つSIWEメッセージの例です:

```
example.com wants you to sign in with your Ethereum account:
0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2

I accept the ExampleOrg Terms of Service: https://example.com/tos

URI: https://example.com/login
Version: 1
Chain ID: 1
Nonce: 32891756
Issued At: 2021-09-30T16:25:24Z
Resources:
- ipfs://bafybeiemxf5abjwjbikoz4mc3a3dla6ual3jsgpdr4cjr3oz3evfyavhwq/
- https://example.com/my-web2-claim.json
```

以下は、暗黙的なスキームと明示的なポートを持つSIWEメッセージの例です:

```
example.com:3388 wants you to sign in with your Ethereum account:
0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2

I accept the ExampleOrg Terms of Service: https://example.com/tos

URI: https://example.com/login
Version: 1
Chain ID: 1
Nonce: 32891756
Issued At: 2021-09-30T16:25:24Z
Resources:
- ipfs://bafybeiemxf5abjwjbikoz4mc3a3dla6ual3jsgpdr4cjr3oz3evfyavhwq/
- https://example.com/my-web2-claim.json
```

以下は、明示的なスキームを持つSIWEメッセージの例です:

```
https://example.com wants you to sign in with your Ethereum account:
0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2

I accept the ExampleOrg Terms of Service: https://example.com/tos

URI: https://example.com/login
Version: 1
Chain ID: 1
Nonce: 32891756
Issued At: 2021-09-30T16:25:24Z
Resources:
- ipfs://bafybeiemxf5abjwjbikoz4mc3a3dla6ual3jsgpdr4cjr3oz3evfyavhwq/
- https://example.com/my-web2-claim.json
```

### Ethereum アカウントでのメッセージの署名と検証

- 外部所有アカウント(EOA)の場合、[ERC-191](./eip-191.md)で指定された検証方法を使用する必要があります。

- コントラクトアカウントの場合:
    - [ERC-1271](./eip-1271.md)で指定された検証方法を使用する必要があり、それ以外の場合、実装者は明確に検証方法を定義する必要があります。これにより、ウォレットと依存当事者の両方のセキュリティと相互運用性を確保します。
    - [ERC-1271](./eip-1271.md)の署名検証を行う際、指定された`chain-id`から解決されたコントラクトで検証を行う必要があります。
    - 実
装者は、[ERC-1271](./eip-1271.md)の実装が純粋な関数ではなく、ブロックチェーンの状態に応じて同じ入力に対して異なる結果を返す可能性があることを考慮する必要があります。これにより、セキュリティモデルとセッション検証ルールに影響を与える可能性があります。例えば、[ERC-1271](./eip-1271.md)署名を有効にしたサービスは、状態の変更を通知するWebフックに依存し、通知を受け取ると、一致するセッションを無効化する可能性があります。

### Ethereum Name Service (ENS) データの解決

- 依存当事者またはウォレットは、ユーザーエクスペリエンスを向上させるために、ENSデータの解決を追加で行うことができます。これにより、`address`に関連する人間が読める情報を表示できます。解決可能なENSデータには以下が含まれます:
    - [主要なENS名](./eip-181.md)。
    - ENSアバター。
    - ENSドキュメントで指定されているその他の解決可能なリソース。
- ENSデータの解決を行う場合、実装者はユーザープライバシーと同意を保護するための対策を講じる必要があります。`address`がデータ解決のプロセスの一環として第三者サービスに転送される可能性があるためです。

### 依存当事者の実装手順

#### リクエスト発信元の指定

- SIWEメッセージの`domain`と、存在する場合の`scheme`は、署名リクエストが行われた発信元のオリジンと一致する必要があります。例えば、親ブラウザウィンドウに埋め込まれたクロスオリジンのiframeでサインインリクエストが行われた場合、`domain`(および存在する場合の`scheme`)はiframeのオリジンと一致する必要があり、親ウィンドウのオリジンとは一致しません。これは、セキュリティ上の理由から、iframeが祖先ウィンドウのいずれかの発信元を誤って主張することを防ぐ上で重要です。この動作は、準拠したウォレットによって強制されます。

#### 署名されたメッセージの検証

- SIWEメッセージは、前述の[ABNF メッセージフォーマット](#abnf-メッセージフォーマット)への準拠を確認し、解析後の期待値(例えば`expiration-time`、`nonce`、`request-uri`など)と照合し、[Ethereum アカウントでのメッセージの署名と検証](#ethereum-アカウントでのメッセージの署名と検証)で定義された方法に従って署名の検証を行う必要があります。

#### セッションの作成

- セッションは`address`にバインドされ、変更可能な解決済みリソースには依存してはいけません。

#### Resourcesの解釈と解決

- 実装者は、SIWEメッセージに記載された`resources`のURIがプレーンテキスト形式で人間に読みやすいことを確認する必要があります。
- `resources`リストの解釈は、この仕様の範囲外です。

### ウォレットの実装手順

#### メッセージフォーマットの検証

- 完全なSIWEメッセージは、[ABNF メッセージフォーマット](#abnf-メッセージフォーマット)への準拠を確認する必要があります。
- ウォレットの実装者は、[ERC-191](./eip-191.md)メッセージ署名リクエストに `"wants you to sign in with your Ethereum account"` という文字列が含まれている場合、[ABNF メッセージフォーマット](#abnf-メッセージフォーマット)に完全に準拠していない限り、ユーザーに警告を表示する必要があります。

#### リクエスト発信元の検証

- ウォレットの実装者は、SIWEメッセージの`scheme`および`domain`フィールドと照合することで、フィッシング攻撃を防ぐ必要があります。例えば、`"example.com wants you to sign in..."`で始まるSIWEメッセージを処理する際、リクエストが実際に`https://example.com`から発信されたことを確認します。
- オリジンは、ブラウザウィンドウやWalletConnect([ERC-1328](./eip-1328.md))セッションなどの信頼できるデータソースから読み取る必要があります。
- ウォレットの実装者は、オリジンがlocalhost を指している場合、拒否する代わりに警告を表示することができます。

以下は、この仕様で定義されたリクエスト発信元の検証要件に準拠するためのウォレットにとって推奨されるアルゴリズムです。

このアルゴリズムは以下の入力変数を受け取ります:

- SIWEメッセージからのフィールド。
- サインインリクエストの`origin` - ブラウザウォレットの実装の場合、プロバイダーにサインインをリクエストしたページのオリジン。
- `allowedSchemes` - ウォレットが許可するスキームのリスト。
- `defaultScheme` - 指定がない場合に想定するスキーム。ブラウザ上のウォレットの実装者は `https` を使用する必要があります。
- 開発者モードの指定 - 特定のリスクを警告ではなく拒否とするかどうかを決める設定。手動で設定するか、`origin`がlocalhost であることから派生させることができます。

アルゴリズムは以下のように記述されます:

- `scheme`が提供されていない場合は、`defaultScheme`を`scheme`として割り当てます。
- `scheme`が`allowedSchemes`に含まれていない場合、その`scheme`は予期されておらず、ウォレットはリクエストを拒否する必要があります。ブラウザ上のウォレットの実装者は、開発者モードが有効でない限り、`allowedSchemes`を`'https'`のみに制限する必要があります。
- `scheme`が`origin`のスキームと一致しない場合、ウォレットはリクエストを拒否する必要があります。ウォレットの実装者は、開発者モードが有効な場合、拒否する代わりに警告を表示することができます。その場合、ウォレットはリクエストの処理を続行します。
- `domain`の`host`部分と`origin`が一致しない場合、ウォレットはリクエストを拒否する必要があります。ただし、ウォレットが開発者モードの場合は、拒否する代わりに警告を表示し、リクエストの処理を続行することができます。
- `domain`と`origin`のサブドメインが一致しない場合、ウォレットはリクエストを拒否する必要があります。ただし、ウォレットが開発者モードの場合は、拒否する代わりに警告を表示し、リクエストの処理を続行することができます。
- `domain`にポートが含まれている場合は`port`として、含まれていない場合は`scheme`に指定されたデフォルトポートを`port`として割り当てます。
- `port`が空でない場合、ウォレットは`port`が`origin`のポートと一致しない場合、警告を表示する必要があります。
- `port`が空の場合、ウォレットは`origin`に特定のポートが含まれている場合、警告を表示することができます。(注意: 'https'のデフォルトポートは443なので、これは`allowedSchemes`に通常でないスキームが含まれている場合にのみ適用されます)
- リクエスト発信元の検証が完了したことを返します。

#### Ethereum でのサインインインターフェイスの作成

- ウォレットの実装者は、SIWEメッセージリクエストから以下のフィールドをデフォルトで、かつ署名前にユーザーに表示する必要があります(存在する場合): `scheme`、`domain`、`address`、`statement`、`resources`。その他のフィールドも、デフォルトまたは拡張インターフェイスを通じて、署名前にユーザーに提示する必要があります。
- プレーンテキストのSIWEメッセージをユーザーに表示するウォレットの実装者は、ユーザーが署名する前にテキストエリアの最下部までスクロールするよう要求する必要があります。
- ウォレットの実装者は、ABNF用語をデータ要素に解析してカスタムのSIWEユーザーインターフェイスを構築することができます。上記の表示ルールは、カスタムインターフェイスにも適用されます。

#### 国際化(i18n)のサポート

- メッセージをABNF用語に正常に解析した後、ユーザーインターフェイスレベルで人間の言語に翻訳することができます。

## 根拠

### 要件

Ethereum でのサインインの仕様を作成する。仕様は単純で、既存の慣行に概ね従うものとする。特に、あまり使われていないプロジェクトの取り込みなど、機能の肥大化は避ける。コアの仕様は分散型、オープン、非独占的で、長期的な存続性を持つ必要がある。中央集権的なサーバーへの依存は、ユーザーがサインインしているアプリケーションが既に運用しているサーバーを除いて、ない必要がある。基本的な仕様には、認証に使用される Ethereum アカウント、ユーザー名としての ENS 名(逆引き解決を介して)、ENS 名のテキストレコードからの追加プロファイル情報(アバター、SNSハンドル等)が含まれる必要がある。

その他の機能要件:

1. ユーザーは、署名前に、JSONブロブ、16進コード(Ethereum アドレスを除く)、base64エンコーディング文字列などの機械向けの成果物から概ね自由な、人間が理解できるインターフェイスを提示される必要がある。
2. アプリケーションサーバーは、ウォレットの変更を強制することなく、完全に使用可能なサポートを実装できる必要がある。
3. アプリケーションとウォレットが既に使用しているEthereumアカウントベースの認証のための、シンプルで明確なアップグレードパスが必要である。
4. 中間者攻撃(MITM)、リプレイ攻撃、悪意のある署名リクエストの適切な緩和策のための機能と指針が必要である。

### 設計目標

1. 人間に優しい
2. 実装が簡単
3. セキュア
4. マシンリーダブル
5. 拡張可能

### 技術的な決定

- なぜ[ERC-191](./eip-191.md)(署名データ標準)を[EIP-712](./eip-712.md)(Ethereum 型構造化データのハッシュ化と署名)より選んだか
    - [ERC-191](./eip-191.md)はウォレットのUXで広く採用されているのに対し、[EIP-712](./eip-712.md)の友好的なユーザー表示のサポートは保留中です。**(1, 2, 3, 4)**
    - [ERC-191](./eip-191.md)は、署名前にプリフィックスを設定するだけで簡単に実装できますが、[EIP-712](./eip-712.md)は、Solidityスタイルの型システム、RLPベースのエンコーディング形式、カスタムのkeccak ベースのハッシュ化スキームの実装など、より複雑です。**(2)**
    - [ERC-191](./eip-191.md)は人間に読みやすいメッセージを生成しますが、[EIP-712](./eip-712.md)はマシン向けの署名出力を生成し、ほとんどのウォレットがユーザーに署名対象のペイロードを人間に優しい形式で表示していません。**(1)**![](../assets/eip-4361/signing.png)

    - [EIP-712](./eip-712.md)には、オンチェーンでの表現とオンチェーンでの検証可能性(メタトランザクションなどで使用)という利点がありますが、この機能は本仕様の範囲外です。**(2)**
- なぜJWTを使わないか? ウォレットはJWTをサポートしていません。keccak ハッシュ関数はJOSEアルゴリズムとしてIANAに割り当てられていません。**(2, 3)**
- なぜYAMLやYAMLの例外を使わないか? YAMLはABNFに比べて緩やかで、文字セットの制限、必須の順序付け、厳密な空白の扱いなどを簡単に表現できません。**(2, 3)**

### 範囲外

以下の懸念は、この仕様のバージョンでは定義の対象外です:

- Ethereum アドレスに基づかない追加の認証。
- サーバーリソースへ
の承認。
- URIの`resources`フィールドの解釈としての要求や他のリソース。
- ドメインバインディングを確実にするための具体的なメカニズム。
- ノンスの生成と適切性の評価のための具体的なメカニズム。
- TLS接続なしでの使用プロトコル。

### 将来の互換性への配慮

以下の項目は、この仕様の反復版または本仕様を前提とする新しい作業項目で、将来的なサポートを検討するためのものです。

- 分散型識別子(DID)と検証可能な資格情報のサポート。
- クロスチェーンサポートの可能性。
- SIOPv2サポートの可能性。
- [EIP-712](./eip-712.md)の将来的なサポート。
- バージョン解釈ルール(例: 理解しているマイナーリビジョンより大きいが、メジャーバージョンより小さい場合に署名する)。

## 下位互換性

- ほとんどのウォレットの実装は既に[ERC-191](./eip-191.md)をサポートしているため、これをベースパターンとし、追加機能を備えています。
- 要件は、利用規約の受諾ステートメント、リプレイ保護のためのノンス、Ethereum アドレス自体のメッセージへの含含など、既存の同様のサインインワークフローの実装から収集されました。

## 参考実装

参考実装は[こちら](../assets/eip-4361/example.js)にあります。

## セキュリティ上の考慮事項

### 識別子の再利用

- 完全なプライバシーを目指すなら、デジタルインタラクションごとに新しい無相関の識別子(Ethereum アドレスなど)を使用し、必要最小限の情報のみを選択的に開示するのが理想的です。
- この懸念は、Ethereum アドレスやENS名を意図的に公開プレゼンスに関連付けている、おそらく初期アダプターとなるユーザー層にとっては、あまり重要ではありません。これらのユーザーは多くのサービスにわたって単一の相関したアイデンティティを維持することを好む傾向にあります。
- メインストリームでの採用に伴い、この考慮事項が重要になってきます。HD ウォレット、署名された委任、ゼロ知識証明など、いくつかのアプローチがありますが、これらは本仕様の範囲外で、後続の仕様に適しています。

### 鍵管理

- Ethereum でのサインインにより、ユーザーは自身の鍵を通じて管理権を持ちます。これは、一般ユーザーが慣れ親しんでいない追加の責任であり、特に個人にとって鍵管理は難しい問題です。例えば、中央集権的なアイデンティティプロバイダーが一般的に実装する「パスワードを忘れた」ボタンのようなものはありません。
- この仕様の初期アダプターは、おそらく既に鍵管理に熟練しているため、この考慮事項はメインストリームでの採用に伴ってより重要になります。
- 特定のウォレットは、スマートコントラクトやマルチシグを使って、鍵の使用と鍵の回復に関してユーザーエクスペリエンスを向上させることができ、これらは[ERC-1271](./eip-1271.md)署名を介してサポートできます。

### ウォレットと依存当事者の組み合わせたセキュリティ

- ユーザーにとってのセキュリティ向上のためには、ウォレットと依存当事者の両方がこの仕様を実装する必要があります。具体的には、ウォレットは、SIWEメッセージが正しいリクエスト発信元用に作成されたものであることを確認する必要があります(TLS保護されたWebサイトの正しいドメインを視覚的に確認する手順などを提供する)。そうでない場合、ユーザーはフィッシング攻撃の対象となります。

### ウォレットとサーバーの相互作用の最小化

- ウォレットサインインワークフローの一部の実装では、サーバーがまずSIWEメッセージのパラメータをウォレットに送信します。一方で、クライアントサイド(dappsなど)で完全にSIWEメッセージを生成する実装もあります。後者のサーバー初期相互作用のないアプローチは、ウォレット-サーバー間の相互作用を最小限に抑えることでユーザープライバシーの利点がある場合に好ましいです。多くの場合、バックエンドサーバーが最初にリプレイ攻撃を防ぐためのノンスを生成し、それを検証します。プライバシーを保護する代替案は次のセクションで提案されています。
- ウォレットがユーザーにSIWEメッセージの署名リクエストを提示する前に、適切な`nonce`や要求された`resources`セットなど、署名するメッセージの内容をサーバーに問い合わせることができます。サーバーとの通信時、ウォレットはユーザー情報の露出を最小限に抑えるためのプライバシー保護措置を講じる必要があります。
- 署名前に、ウォレットはユーザーの設定(複数の`address`から1つを選択する、優先するENS名を選択するなど)を確認することができます。

### リプレイ攻撃の防止

- セッション開始ごとに、リプレイ攻撃を防ぐのに十分なエントロピーを持つ`nonce`を選択する必要があります。リプレイ攻撃とは、攻撃者がユーザーの署名をキャプチャーし、それを使って自身の新しいセッションを確立する攻撃です。
- 実装者は、最近のEthereum ブロックハッシュや最近のUnixタイムスタンプなど、プライバシーを保護しつつ広く利用可能な`nonce`値を使用することを検討できます。

### フィッシング攻撃の防止

- フィッシング攻撃を防ぐために、ウォレットは[リクエスト発信元の検証](#リクエスト発信元の検証)に記載された要件を実装する必要があります。

### チャネルのセキュリティ

- Webベースのアプリケーションの場合、メッセージ署名時の通信はすべてHTTPSを使用して、中間者攻撃を防ぐ必要があります。
- HTTPS以外のプロトコルを使用する場合、機密性、データ整合性、送信者/受信者の認証性を維持するための適切な手法を使用する必要があります。

### セッションの無効化

実装者は、以下のような状態の変化に対してセッションを無効化することを検討する必要があります。

- [ERC-1271](./eip-1271.md)の実装や依存データが署名計算に影響を与える場合、サーバーは適切にセッションを無効化する必要があります。
- `resources`で指定されたリソースが変更された場合、サーバーは適切にセッションを無効化する必要があります。ただし、`resources`の解釈は本仕様の範囲外です。

### ABNF用語の最大長

- この仕様には用語の最大長に関する規定的な要件はありませんが、実装者は、サービス拒否攻撃の防止、任意のユースケースのサポート、ユーザーの読みやすさのバランスを取るような最大長を選択する必要があります。

## 著作権

著作権およびそれに関連する権利は[CC0](../LICENSE.md)で放棄されています。