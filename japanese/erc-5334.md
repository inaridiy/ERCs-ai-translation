---
original: a1f5d9f2c8f01d11f629f79bfc5fbffa67004a68acecd3bdf42df85470110bd8
---

---
eip: 5334
title: EIP-721 ユーザーと有効期限と階層の拡張
description: EIP-721トークンに時間制限付きの制限付き権限ロールを追加する。
author: Yan (@yan253319066)
discussions-to: https://ethereum-magicians.org/t/erc-721-user-and-expires-and-level-extension/10097
status: 停滞
type: Standards Track
category: ERC
created: 2022-07-25
requires: 165, 721
---

## 概要

[EIP-721](./eip-721.md)の拡張機能で、アドレスに付与できる追加のロール(`ユーザー`)と、ロールが自動的に取り消される時間(`有効期限`)と(`レベル`)を追加します。`ユーザー`ロールは、NFTを"使用"する権限を表しますが、それを譲渡したり、ユーザーを設定する権限はありません。

## 動機

一部のNFTには特定の用途があります。例えば、バーチャルランドでは、シーンを構築するために"使用"することができ、ゲームアセットを表すNFTは、ゲーム内で"使用"することができます。所有者とユーザーが常に同じではない場合があります。NFTの所有者がそれをレンタルする"ユーザー"がいる可能性があります。"ユーザー"が NFTで行えるアクションは、"所有者"とは異なるはずです(例えば、"ユーザー"は通常、NFTの所有権を売却することはできません)。このような場合、"所有者"と"ユーザー"を識別するための別々のロールを持ち、それに応じて権限を管理することが合理的です。

一部のプロジェクトでは、すでに"オペレーター"や"コントローラー"などの異なる名称でこの設計スキームを使用していますが、これがますます一般的になるにつれ、すべてのアプリケーションの協力を促進するための統一された標準が必要になります。

さらに、このモデルの適用例(レンタルなど)では、ユーザーアドレスがNFTの使用権限を一時的にのみ持つことが多くあります。通常、これは所有者が2つのオンチェーントランザクションを送信する必要があることを意味します。1つは使用期間の開始時にユーザーロールの新しいアドレスをリストアップし、もう1つは使用期間の終了時にユーザーロールを再び取り戻すためのものです。これは労力とガスの両面で非効率的なため、使用期間の自動終了を可能にする`有効期限`と`レベル`機能が導入されます。

この標準によって解決される問題は以下の通りです:

### 明確な権利の割り当て

"所有者"と"ユーザー"の2つのロールにより、レンダーとボロワーがNFTで何をすることができ、何ができないかを管理することが大幅に容易になります(つまり、彼らの権利)。さらに、所有者はユーザーを制御できるようになり、他のプロジェクトも所有者またはユーザーに独自の権利を割り当てやすくなります。

### シンプルなオンチェーンタイム管理

レンタル期間が終了すると、ユーザーロールをリセットし、"ユーザー"がNFTの使用権を失うようにする必要があります。これは通常、2つ目のオンチェーントランザクションで行われますが、ガスの非効率性と不正確さから問題が生じる可能性があります。`有効期限`機能を使えば、別のトランザクションは不要で、"ユーザー"の権限は期間終了後に自動的に無効になります。

### 簡単な第三者統合

パーミッションレスな相互運用性の精神に基づき、この標準により、NFT発行者やNFTアプリケーションの許可なしに、第三者プロトコルがNFT使用権を管理しやすくなります。プロジェクトが追加の`ユーザー`ロールと`有効期限`と`レベル`を採用すれば、他のプロジェクトがこれらの機能に直接アクセスし、独自のトランザクションタイプを実装できます。例えば、この標準を使用するPFP NFTは、ユーザーが30日間NFTをレンタルできるレンタルプラットフォームと、ユーザーが分割払いでNFTの所有権を最終的に購入できる抵当プラットフォームの両方に統合できます。これはすべて、オリジナルのPFPプロジェクトの許可なしに行えます。

## 仕様

この文書の中の "MUST"、"MUST NOT"、"REQUIRED"、"SHALL"、"SHALL NOT"、"SHOULD"、"SHOULD NOT"、"RECOMMENDED"、"MAY" および "OPTIONAL" のキーワードは、RFC 2119に記載されているように解釈されるものとします。

### コントラクトインターフェース
Solidity インターフェースと NatSpec & OpenZeppelin v4 インターフェース (また、[`IERC5334.sol`](../assets/eip-5334/IERC5334.sol)にも用意されています):

```solidity
interface IERC5334 {

    // NFTのユーザー、有効期限、またはレベルが変更されたときにログに記録される
    /// @notice NFTの`ユーザー`や`有効期限`が変更された、または`ユーザーレベル`が変更されたときに発行される
    /// ユーザーアドレスがゼロアドレスの場合、ユーザーがいないことを示す
    event UpdateUser(uint256 indexed tokenId, address indexed user, uint64 expires, uint8 level);

    /// @notice NFTのユーザーと有効期限とレベルを設定する
    /// @dev ゼロアドレスはユーザーがいないことを示す
    /// `tokenId`が有効なNFTでない場合は例外をスローする
    /// @param user  NFTの新しいユーザー
    /// @param expires  UNIX タイムスタンプ、ユーザーがNFTを使用できる期限
    /// @param level ユーザーのレベル
    function setUser(uint256 tokenId, address user, uint64 expires, uint8 level) external;

    /// @notice NFTのユーザーアドレスを取得する
    /// @dev ゼロアドレスは、ユーザーがいないか、ユーザーが期限切れであることを示す
    /// @param tokenId ユーザーアドレスを取得するNFT
    /// @return このNFTのユーザーアドレス
    function userOf(uint256 tokenId) external view returns(address);

    /// @notice NFTのユーザーの有効期限を取得する
    /// @dev ゼロ値は、ユーザーがいないことを示す
    /// @param tokenId ユーザーの有効期限を取得するNFT
    /// @return このNFTのユーザーの有効期限
    function userExpires(uint256 tokenId) external view returns(uint256);

    /// @notice NFTのユーザーのレベルを取得する
    /// @dev ゼロ値は、ユーザーがいないことを示す
    /// @param tokenId ユーザーのレベルを取得するNFT
    /// @return このNFTのユーザーのレベル
    function userLevel(uint256 tokenId) external view returns(uint256);
}
```

`userOf(uint256 tokenId)` 関数は `pure` または `view` として実装できます。

`userExpires(uint256 tokenId)` 関数は `pure` または `view` として実装できます。

`userLevel(uint256 tokenId)` 関数は `pure` または `view` として実装できます。

`setUser(uint256 tokenId, address user, uint64 expires)` 関数は `public` または `external` として実装できます。

`UpdateUser` イベントは、ユーザーアドレスが変更されたとき、ユーザーの有効期限が変更されたとき、またはユーザーのレベルが変更されたときに必ず発行されなければなりません。

<!-- `supportsInterface` メソッドは、`0xTODO` で呼び出された場合に `true` を返さなければなりません。 -->

## 根拠

TBD

## 下位互換性

仕様セクションで述べたように、この標準はEIP-721との完全な互換性を持つ拡張機能セットとして実装できます。

さらに、この標準で導入された新しい関数は、既存のEIP-721の関数と多くの類似点があるため、開発者が迅速に標準を採用できます。

## 参考実装
この標準の参考実装は、アセットフォルダーにあります。
<!-- [../assets/EIP-5334/ERC5334.sol](../assets/EIP-5334/ERC5334.sol). -->

## セキュリティ上の考慮事項

このEIP標準により、所有者の権利を完全に保護できます。所有者はいつでもNFTのユーザーと有効期限とレベルを変更できます。

## 著作権
著作権およびそれに関連する権利は[CC0](../LICENSE.md)で放棄されています。