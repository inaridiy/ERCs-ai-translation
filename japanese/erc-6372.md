---
original: ab569bc8ba455aa11c20033a607cfbc9b8b0b987d9eccc72549c5c9fcb57a086
---

---
eip: 6372
title: コントラクトクロック
description: コントラクトのクロック値と詳細を公開するためのインターフェース
author: Hadrien Croubois (@Amxx), Francisco Giordano (@frangio)
discussions-to: https://ethereum-magicians.org/t/eip-6372-contract-clock/12689
status: レビュー
type: Standards Track
category: ERC
created: 2023-01-25
---

## 概要

多くのコントラクトは遅延の強制や履歴データの保存に何らかのクロックを頼りにしています。一部のコントラクトはブロック番号を使用し、他のコントラクトはタイムスタンプを使用しています。現在、コントラクトが内部的に使用しているタイム追跡機能を発見する簡単な方法はありません。このEIPは、コントラクトが内部クロックを公開するためのインターフェースを標準化することを提案し、コンポーザビリティとインターオペラビリティの向上を目指します。

## 動機

多くのコントラクトは時間関連の情報をチェックまたは保存します。例えば、タイムロックコントラクトは操作の実行前に遅延を強制します。同様に、DAOは提案を承認または拒否するための投票期間を強制します。最後に、投票トークンは時間ベースのスナップショットを使用して投票パワーの履歴を保存することがよくあります。

一部のコントラクトはタイムスタンプを使ってタイム追跡を行い、他のコントラクトはブロック番号を使用します。場合によっては、より特殊な関数がタイム追跡に使用されることもあります。

外部の観察者がコントラクトが使用しているクロックを検出する方法がありません。これは深刻な相互運用性の制限となり、開発者に危険な前提を強います。

## 仕様

この文書の中の「MUST」、「MUST NOT」、「REQUIRED」、「SHALL」、「SHALL NOT」、「SHOULD」、「SHOULD NOT」、「RECOMMENDED」、「MAY」、「OPTIONAL」というキーワードは、RFC 2119に記載されているように解釈されるものとします。

準拠するコントラクトは、以下のように指定された `clock` および `CLOCK_MODE` 関数を実装しなければなりません。

```solidity
interface IERC6372 {
  function clock() external view returns (uint48);
  function CLOCK_MODE() external view returns (string);
}
```

### メソッド

#### clock

この関数は、コントラクトが動作しているモードに従った現在の時点を返します。これは、`block.timestamp` や `block.number` のような、チェーンの非減少関数でなければなりません。

```yaml
- name: clock
  type: function
  stateMutability: view
  inputs: []
  outputs:
    - name: timepoint
      type: uint48
```

#### CLOCK_MODE

この関数は、コントラクトが動作しているクロックの機械可読の文字列説明を返します。

この文字列は、標準的なJavaScriptの `new URLSearchParams(CLOCK_MODE)` で解析可能な、URLクエリ文字列(a.k.a. `application/x-www-form-urlencoded`)の形式でなければなりません。

- **ブロック番号**を使用している場合:
  - `NUMBER` オペコード (`0x43`) のブロック番号の場合、この関数は `mode=blocknumber&from=default` を返さなければなりません。
  - それ以外のブロック番号の場合、この関数は `mode=blocknumber&from=<CAIP-2-ID>` を返さなければなりません。ここで `<CAIP-2-ID>` は、CAIP-2 Blockchain IDのようなものです。
- **タイムスタンプ**を使用している場合、この関数は `mode=timestamp` を返さなければなりません。
- その他のモードを使用している場合、この関数は `mode` フィールドの一意の識別子を返すべきです。

```yaml
- name: CLOCK_MODE
  type: function
  stateMutability: view
  inputs: []
  outputs:
    - name: descriptor
      type: string
```

### 期待される特性

- `clock()` 関数は非減少でなければなりません。

## 根拠

`clock` は `uint48` を返します。これは現実的な値を保存するのに十分です。タイムスタンプモードでは、`uint48` は8921556年まで十分です。ブロック番号モードでも、1秒あたり10,000ブロックの場合、2861年まで十分です。`uint256` よりも小さな型を使うことで、時点に関連する他の値との格納が可能になり、ストレージへの書き込みと読み取りのコストが大幅に削減されます。

ブロックチェーンの進化(特にレイヤー2)によっては、`uint32` のような更に小さな型を使うと、かなり早期に問題が発生する可能性があります。一方、`uint48` よりも大きな型を使うのは無駄に見えます。

タイムスタンプに加えて、期間や遅延を定義する必要がある場合があります。これらは時点の差として表現されます。一般的には、これらの値も時点と同じ型(`uint48`)で表現されることが期待されます。ただし、ほとんどの場合、`uint32`が良い代替案だと考えています。これは、クロックが秒単位で動作する場合、136年以上を表現できます。ほとんどの場合、時点には `uint48` を、期間には `uint32` を使うことをお勧めします。この推奨は、タイムスタンプやブロック番号が1秒以上離れている「妥当な」期間(タイムロックの遅延、投票期間、ベスティング期間など)に適用されます。

## セキュリティ上の考慮事項

既知のセキュリティ上の問題はありません。

## 著作権

著作権およびそれに関連する権利は[CC0](../LICENSE.md)により放棄されています。