---
original: 5c619517a1a8c3d446e3c26ded30438f01c60ed3deb18e89f07a85ea07030306
---

---
eip: 4400
title: EIP-721 消費可能拡張
description: EIP-721 消費者ロールのインターフェース拡張
author: Daniel Ivanov (@Daniel-K-Ivanov), George Spasov (@Perseverance)
discussions-to: https://ethereum-magicians.org/t/EIP-4400-EIP721consumer-extension/7371
status: 最終
type: 標準トラック
category: ERC
created: 2021-10-30
requires: 165, 721
---

## 概要

この仕様は、[EIP-721](./eip-721.md)のインスタンスの `消費者` ロールを定義する標準関数を定義しています。実装では、特定のNFT (`tokenId`)の現在の `消費者` を読み取ることができ、`消費者`が変更されたときの標準化されたイベントが提供されます。この提案は、既存の[EIP-721](./eip-721.md)に依存し、それを拡張するものです。

## 動機

多くの[EIP-721](./eip-721.md)コントラクトは、特定のNFTインスタンスを利用/消費するための権限を付与する独自のカスタムロールを導入しています。このようなロールが必要になるのは、NFTインスタンスを所有しているだけでは、NFTに対してさまざまな操作を行うことができないためです。例えば、さまざまなメタバースでは、土地(EIP-721)に `オペレーター` / `コントリビューター` ロールを使用しており、土地の所有者がそれらのアドレスにシーンの展開を許可できるようになっています(例えば、サービス会社にシーンの開発を委託する場合など)。

NFTには所有権以外のユーティリティがあることは一般的です。そのため、ユーザーインターフェースやコントラクトの管理を可能にする、別の標準化された消費者ロールが必要となります。

`消費者` ロールを持つことで、EIP-721トークンを発行するdAppにプロトコルを統合し、それらの上に構築することができます。一例として、汎用/ユニバーサルなNFTレンタルマーケットプレイスの作成が挙げられます。

この標準から恩恵を受けることができる契約やアプリケーションの例は以下のようなものです:
- メタバースで土地やその他のデジタルアセットを持つもの(土地へのシーン展開、土地/キャラクター/衣装/イベントパスのレンタルなど)
- NFTベースの収益ファーミング。標準を採用することで、NFTの所有者(ステーカー)がNFTをステーキング契約に転送した後も、ユーティリティ上の恩恵を受けられるようになります。

## 仕様

この文書の中の "MUST"、"MUST NOT"、"REQUIRED"、"SHALL"、"SHALL NOT"、"SHOULD"、"SHOULD NOT"、"RECOMMENDED"、"MAY"、"OPTIONAL" というキーワードは、RFC 2119に記載されているように解釈されるものとします。

`EIP721Consumable` 拡張に準拠するすべてのコントラクトは、`IEIP721Consumable` インターフェースを実装しなければなりません。**消費者拡張**は、EIP-721コントラクトにとって任意のものです。

```solidity
/// @title EIP-721 消費者ロール拡張
///  Note: このインターフェースのEIP-165識別子は 0x953c8dfa
interface IEIP721Consumable /* is EIP721 */ {

    /// @notice NFTの `消費者` が `owner` によって変更されたときに発行されるイベント
    /// 消費者アドレスがゼロアドレスの場合、NFTに消費者がいないことを示します
    /// Transfer イベントが発行されると、そのNFTの消費者アドレス(存在する場合)がゼロに設定されたことを示します
    event ConsumerChanged(address indexed owner, address indexed consumer, uint256 indexed tokenId);

    /// @notice NFTの消費者アドレスを取得する
    /// @dev ゼロアドレスは、消費者がいないことを示します
    /// `_tokenId` が有効なNFTでない場合は例外をスローします
    /// @param _tokenId 消費者アドレスを取得するNFT
    /// @return このNFTの消費者アドレス。消費者がいない場合はゼロアドレス
    function consumerOf(uint256 _tokenId) view external returns (address);

    /// @notice NFTの消費者アドレスを変更または再確認する
    /// @dev ゼロアドレスは、消費者アドレスがないことを示します
    /// `msg.sender` が現在のNFT所有者、承認されたオペレーター、または承認されたアドレスでない限り、例外をスローします
    /// `_tokenId` が有効なNFTでない場合は例外をスローします
    /// @param _consumer NFTの新しい消費者
    function changeConsumer(address _consumer, uint256 _tokenId) external;
}
```

`EIP721Consumable` 拡張を実装するすべてのコントラクトは、`消費者` の権限(システム内で消費者に許可されている操作など)を自由に定義できます。ただし、消費者は EIP-721 仕様に従って所有者、承認されたオペレーター、または承認されたアドレスとは見なされてはいけません。したがって、彼らは転送や承認を実行することはできません。

`consumerOf(uint256 _tokenId)` 関数は `pure` または `view` として実装できます。

`changeConsumer(address _consumer, uint256 _tokenId)` 関数は `public` または `external` として実装できます。

`ConsumerChanged` イベントは、消費者が変更されたときに必ず発行されなければなりません。

すべての `transfer` 時に、消費者はデフォルトのアドレスに変更されなければなりません。実装者は、そのデフォルトアドレスとして `address(0)` を使うことをお勧めします。

`supportsInterface` メソッドは、`0x953c8dfa` で呼び出された場合に `true` を返さなければなりません。

## 根拠

この標準に影響を与えた主な要因は以下の通りです:

- インターフェースの関数数を最小限に抑えてコントラクトの肥大化を防ぐこと
- 簡潔性
- ガス効率
- 既存の他のロール(所有者、オペレーター、承認されたアドレスなど)を再利用または過負荷にしないこと

### 名称

選択された名称は、その存在目的と呼応しています。消費者は、必ずしも所有権を持っていなくても、トークンインスタンスを利用するエンティティと見なすことができます。

検討された別の名称は `オペレーター` でしたが、これは既に `EIP-721` 標準で定義されて使用されています。

### 権限の制限

NFTに対して別のロールが必要な多くのユースケースがあり、そのロールには所有者の権限を持たせるべきではありません。消費者ロールに所有者の権限を付与するコントラクトでは、この標準の意味がなくなってしまいます。

## 下位互換性

この標準は現在のEIP-721標準と互換性があります。NFTに似たような役割を定義する他の標準はなく、名称(`消費者`)も他のEIP-721関連の標準で使用されていません。

## テストケース

テストケースは、リファレンス実装[こちら](../assets/eip-4400/test/erc721-consumable.ts)にあります。

## リファレンス実装

リファレンス実装は[こちら](../assets/eip-4400/contracts/ERC721Consumable.sol)にあります。

## セキュリティ上の考慮事項

`EIP721Consumable` 標準の実装者は、`消費者` に付与する権限を慎重に検討する必要があります。標準を正しく実装し、NFTの転送/焼却を許可しない場合でも、所有者にのみ許可すべき権限を `消費者` に与えてしまう可能性があるため、注意が必要です。

## 著作権

著作権およびそれに関連する権利は[CC0](../LICENSE.md)で放棄されています。