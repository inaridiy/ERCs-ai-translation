---
original: 29a20532ab53b0664f8c4f1e9941c1dd6044d7762ea0d0758f8aa50f5d0b912f
---

---
eip: 2494
title: Baby Jubjub 楕円曲線
author: Barry WhiteHat (@barryWhiteHat), Marta Bellés (@bellesmarta), Jordi Baylina (@jbaylina)
discussions-to: https://ethereum-magicians.org/t/eip-2494-baby-jubjub-elliptic-curve/3968
status: 停滞
type: Standards Track
category: ERC
created: 2020-01-29
---

## 簡単な要約

このプロポーザルでは、Ethereum内のzk-SNARK回路で使用するためのBaby Jubjub楕円曲線を定義しています。

## 概要

ブロックチェーン技術が個人や業界で広く使用されていない主な理由の2つは、スケーラビリティと privacy保証です。ゼロ知識証明(ZKP)と呼ばれる一連の暗号化ツールを使用すると、これらの問題に対処できます。特に、ブロックチェーンに最適なプロトコルはzk-SNARK(ゼロ知識簡潔非対話的知識証明)と呼ばれ、非対話型で、証明サイズが簡潔で、検証時間がサブリニアです。これらのプロトコルは、有限体(F_r-arithmetic回路とも呼ばれる)で定義された算術回路でモデル化できる一般的な計算ステートメントの証明を可能にします。

zk-SNARKの証明を検証するには、楕円曲線が必要です。Ethereumでは、曲線はalt_bn128(BN254とも呼ばれる)で、素数位数 `r` を持っています。この曲線を使用すると、任意のF_r-arithmetic回路の証明を生成および検証できます。このEIPでは、*Baby Jubjub*と呼ばれる、F_rの有限体上で定義された楕円曲線について説明します。これにより、Pedersen Hashや Edwards Digital Signature Algorithm (EdDSA)などの楕円曲線を使用する暗号プリミティブを実装できます。

## 動機

[ゼロ知識証明](https://en.wikipedia.org/wiki/Zero-knowledge_proof)(ZKP)は、証明者が検証者に、ステートメントが真であることを示す一方で、ステートメントに関する情報以外は何も明かさないプロトコルです。[非対話型ZKP](https://people.csail.mit.edu/silvio/Selected%20Scientific%20Papers/Zero%20Knowledge/Noninteractive_Zero-Knowkedge.pdf)(NIZK)は、証明者が検証者と対話することなく証明を生成できるゼロ知識証明の特殊なタイプです。NIZKプロトコルはEthereum用途に非常に適しています。なぜなら、スマートコントラクトを検証者として機能させることができ、誰もが証明を生成してトランザクションの一部として送信し、証明が有効かどうかに応じてスマートコントラクトが何らかのアクションを実行できるためです。この文脈では、最も好ましいNIZKは[zk-SNARK](https://eprint.iacr.org/2013/279.pdf)(ゼロ知識簡潔非対話的知識証明)と呼ばれる一連の非対話型ゼロ知識プロトコルです。これらのプロトコルの重要性は2つあります。1つは、プライバシー保証を向上させること、もう1つは、スケーラビリティの問題に対する解決策の1つ(例えば、[zk-Rollup](https://github.com/barryWhiteHat/roll_up)プロジェクトを参照)となることです。

ほとんどのZKPと同様に、zk-SNARKsは計算ステートメントの証明を可能にします。例えば、特定の公開鍵に関連付けられた秘密鍵の知識、トランザクションの正しい計算、または特定のハッシュの前イメージの知識を証明できます。重要なのは、これらのことを行う際に、関連するステートメントに関する情報を漏らさないことです。つまり、秘密鍵、トランザクションの詳細、または前イメージの値に関する情報を漏らさないことです。より具体的には、zk-SNARKsは、F_r-arithmetic回路、つまり値がF_rのフィールドから来る一連の配線と、それらを加算および乗算ゲート `mod r` に接続するような回路でモデル化できる任意の計算ステートメントの証明を可能にします。このタイプの回路はしばしばzk-SNARK回路と呼ばれます。

ほとんどのzk-SNARK プロトコル(例えば、[[Pinnochio]](https://eprint.iacr.org/2013/279.pdf)および[[Groth16]](https://eprint.iacr.org/2016/260.pdf))の実装では、楕円曲線を使用して証明を検証します。Ethereumでは、使用される曲線はalt_bn128(BN254とも呼ばれる)で、素数位数 `r` を持っています。BN254を使用してF_r-arithmetic回路の証明を生成および検証することは可能ですが、BN254を使用して回路内で楕円曲線暗号を実装することはできません。[Pedersen Hash](https://github.com/zcash/zips/blob/master/protocol/protocol.pdf)や[Edwards Digital Signature Algorithm](https://tools.ietf.org/html/rfc8032)(EdDSA)などの楕円曲線を必要とする関数をzk-SNARK回路内で実装するには、F_rの座標を持つ新しい曲線が必要です。そのために、このEIPでは、任意のF_r-arithmetic回路内で使用できる*Baby Jubjub*と呼ばれる楕円曲線を提案します。次のセクションでは、この曲線の特性、生成方法、および考慮された安全性について詳しく説明します。

```
    inputs                zk-SNARK (alt_bn128)             output
            +--------------------------------------------+
            |   +--------------------+                   |
        --->|   | EdDSA (Baby Jubjub)|                   |
            |   +--------------------+                   |
        --->|                                            |--->
            |          +-----------------------------+   |
        --->|          | Pedersen Hash (Baby Jubjub) |   |
            |          +-----------------------------+   |
            +--------------------------------------------+
```

## 仕様

### 定義
`F_r`を要素数が`r`の素数有限体とする。ここで
```
r = 21888242871839275222246405745257275088548364400416034343698204186575808495617
```

`E`を`F_r`上で定義された歪みエドワーズ楕円曲線とする。方程式は
```
ax^2 + y^2 = 1 + dx^2y^2
```
で、パラメータは
```
a = 168700
d = 168696
```
**Baby Jubjub**は曲線`E(F_r)`、つまり`E`のF_r-rational点のサブグループを指します。

### 位数

Baby Jubjubの位数は

```
n = 21888242871839275222246405745257275088614511777268538073601725287587578984328
```

で、これは
```
n = h x l
```
と因数分解でき、ここで
```
h = 8
l = 2736030358979909402780800718157159386076813972158567259200215660948447373041
```
パラメータ`h`は*cofactor*と呼ばれ、`l`は251ビットの素数です。

### ジェネレータ点

点`G = (x,y)`の座標は
```
x = 995203441582195749578291179787384436505546430278305826713579947235728471134
y = 5472060717959818805561601436314318772137091100104008585924551046643952123905
```
で、これらの点がすべての`n`点を生成します。

### ベース点

点`B = (x,y)`の座標は

```
x = 5299619240641551281634865583518297030282874472190772894086521144482721001553
y = 16950150798460657717958625567821834550301663161624707787222815936182638968203
```
で、これらの点が`l * P = O`を満たす点`P`のサブグループを生成します。つまり、位数`l`で原点`O`を持つ点を生成します。

### 演算

Baby Jubjubの任意の2点`P1 = (x1, y1)`と`P2 = (x2, y2)`について、`P1 + P2 = (x3, y3)`は次のように計算されます:
```
x3 = (x1*y2 + y1*x2)/(1 + d*x1*x2*y1*y2)
y3 = (y1*y2 - a*x1*x2)/(1 - d*x1*x2*y1*y2)
```
ここで、点の加算と倍加算は1つの式で計算できます。

## 根拠

Baby Jubjubの検索は、F_r-arithmetic回路内で楕円曲線暗号を実装できるようにする必要性から動機付けられました。曲線の選択は、曲線の形式、生成プロセス、および安全性基準の3つの主要な要因に基づいています。このセクションでは、これらの要因がどのように対処されたかを説明します。

**曲線の形式**

Baby Jubjubは**歪みエドワーズ**曲線で、**モンゴメリー**曲線と双有理同値です。この曲線の形式を選択した理由は以下の通りです:
1. エドワーズ曲線デジタル署名方式は歪みエドワーズ曲線に基づいています。
2. 歪みエドワーズ曲線には点の加算に対する単一の完全な式があり、回路内でグループ演算を実装するのが非常に効率的です[[Crypto08/013, Section 6]](https://eprint.iacr.org/2008/013.pdf)。
3. 歪みエドワーズ曲線は一般にモンゴメリー曲線と双有理同値であるため[[Crypto08/13,Theorem 3.2]](https://eprint.iacr.org/2008/013.pdf)、曲線を一方の形式から他方の形式に簡単に変換できます。モンゴメリー曲線での点の加算と倍加算は非常に効率的に実行できるため、回路外の計算をこの形式で高速化し、歪みエドワーズ形式と組み合わせて回路内の計算を高速化できます(詳細は[こちら](http://hyperelliptic.org/EFD/g1p/index.html)を参照)。

**曲線の生成**

Baby Jubjubは、楕円曲線を必要とする暗号スキームの回路実装のための解決策として考案されました。暗号プロトコルの場合と同様に、バックドアの可能性を最小限に抑えることが重要です。そのため、プロセスを**透明**で**決定論的**に設計し、外部の考慮事項が考慮されていないことを明確にし、誰もが再現および追跡できるようにしました。

Baby Jubjubの生成アルゴリズムは、[[RFC7748, Appendix A.1]](https://tools.ietf.org/html/rfc7748)で定義された基準に基づいており、[このGitHubリポジトリ](https://github.com/barryWhiteHat/baby_jubjub)で見つかります。本質的に、このアルゴリズムは素数`p = 1 mod 4`を取り、`A-2`が4の倍数であり、`F_p`の解が`y^2 = x^3 + Ax^2 + x`を満たすモンゴメリー曲線がcofactor 8を持つような最小の`A>0`を返します。

Baby Jubjubは、Ethereumでzk-SNARK証明を検証するのに使用されるalt_bn128曲線の位数`r`

`r =  21888242871839275222246405745257275088548364400416034343698204186575808495617`

を使用して、このアルゴリズムを実行することで生成されました。アルゴリズムの出力は`A=168698`でした。その後、対応するモンゴメリー曲線を歪みエドワーズ形式に変換しました。SAGEライブラリを使用して曲線の位数`n`とその因数分解`n = 8*l`を計算しました。

- **ジェネレータの選択**: ジェネレータ点`G`は、`F_r`内で最小の正の`x`座標を持つ位数`n`の点です。
- **ベース点の選択**: ベース点`B`は`B = 8*G`と選択され、位数`l`を持ちます。

**安全性基準**

Baby Jubjubが既知の攻撃に対して安全であることが重要です。そのため、SafeCurvesが最良の攻撃を収集していることから、曲線がSafeCurvesのセキュリティテストに合格することを決めました。Baby Jubjubがこれらの基準を満たすことの証拠は[こちら](https://github.com/barryWhiteHat/baby_jubjub)にあります。

## 下位互換性

Baby Jubjubは、モンゴメリー形式と別の(異なる表現
の)歪みエドワーズ形式の2つの異なる形式に双有理同値な歪みエドワーズ楕円曲線です。

これまでは、主にオリジナルの形式、モンゴメリー形式、および別の(縮小された歪みエドワーズ)形式で使用されてきました。

以下の3つの表現と、ある形式の曲線から別の形式への写像を示します。すべての場合において、ジェネレータとベース点は**`(x,y)`**の形式で書かれています。

### 曲線の形式

すべてのジェネレータとベース点は(x,y)の形式で書かれています。

**歪みエドワーズ形式** (標準)

- 方程式: ``ax^2 + y^2 = 1 + dx^2y^2``
- パラメータ: ``a = 168700, d = 168696``
- ジェネレータ点:
    ```
    (995203441582195749578291179787384436505546430278305826713579947235728471134, 5472060717959818805561601436314318772137091100104008585924551046643952123905)
    ```
- ベース点:
    ```
    (5299619240641551281634865583518297030282874472190772894086521144482721001553, 16950150798460657717958625567821834550301663161624707787222815936182638968203)
    ```

**モンゴメリー形式**

- 方程式: ``By^2 = x^3 + A x^2 + x``
- パラメータ: ``A = 168698, B = 1``
- ジェネレータ点:
    ```
    (7, 4258727773875940690362607550498304598101071202821725296872974770776423442226)
    ```
- ベース点:
    ```
    (7117928050407583618111176421555214756675765419608405867398403713213306743542, 14577268218881899420966779687690205425227431577728659819975198491127179315626)
    ```

**縮小された歪みエドワーズ形式**

- 方程式: ``a' x^2 + y^2 = 1 + d' x^2y^2``
- パラメータ: 
    ```
    a' = -1 
    d' = 12181644023421730124874158521699555681764249180949974110617291017600649128846
    ```
- ジェネレータ点: 
    ```
    (4986949742063700372957640167352107234059678269330781000560194578601267663727, 5472060717959818805561601436314318772137091100104008585924551046643952123905)
    ```
- ベース点:
    ```
    (9671717474070082183213120605117400219616337014328744928644933853176787189663, 16950150798460657717958625567821834550301663161624707787222815936182638968203)
    ```

### 点の変換

以下の式により、曲線の1つの形式から別の形式への点の変換ができます。座標を以下のように表します:

* ``(u, v)`` はモンゴメリー形式の点
* ``(x, y)`` は歪みエドワーズ形式の点
* ``(x', y')`` は縮小された歪みエドワーズ形式の点

最後の変換 -- 歪みエドワーズから縮小された歪みエドワーズ、そして逆 -- では、スケーリング係数`f`も使用します。ここで:
```
f = 6360561867910373094066688120553762416144456282423235903351243436111059670888
```
式では`-f`を直接使用することもできます。ここで:
```
-f = 15527681003928902128179717624703512672403908117992798440346960750464748824729
```

**モンゴメリー --> 歪みエドワーズ**
```
(u, v) --> (x, y)

x = u/v
y = (u-1)/(u+1)
```

**歪みエドワーズ --> モンゴメリー**
```
(x, y) --> (u, v)

u = (1+y)/(1-y) 
v = (1+y)/((1-y)x)
```

**モンゴメリー --> 縮小された歪みエドワーズ** 
```
(u, v) --> (x', y')

x' = u*(-f)/v 
y' = (u-1)/(u+1) 
```

**縮小された歪みエドワーズ --> モンゴメリー**
```
(x', y') --> (u, v)

u = (1+y')/(1-y')
v = (-f)*(1+y')/((1-y')*x')
```

**歪みエドワーズ --> 縮小された歪みエドワーズ** 
```
(x, y) --> (x', y')

x' = x*(-f)
y' = y
```

**縮小された歪みエドワーズ --> 歪みエドワーズ** 
```
(x', y') --> (x, y)

x = x'/(-f)
y = y'
```

## セキュリティ上の考慮事項

このセクションでは、Baby Jubjubに対して行われた安全性チェックを説明します。セキュリティパラメータの選択は[SafeCurves基準](https://safecurves.cr.yp.to)に基づいており、Baby Jubjubがこれらの要件を満たすことの証拠は[こちら](https://github.com/barryWhiteHat/baby_jubjub)にあります。

**曲線パラメータ**

曲線の仕様に記載されているすべてのパラメータが、素数有限体上の明確に定義された楕円曲線を記述していることを確認します。

- 数`r`は素数です。
- パラメータ`a`と`d`は楕円曲線の方程式に対応しています。
- `h`と`l`の積が曲線の位数とジェネレータ点`G`の位数になります。
- 数`l`は素数で、ベース点`B`の位数は`l`です。

**楕円曲線離散対数問題**

与えられた曲線で離散対数問題が困難であることを確認します。以下の既知の攻撃に対してBaby Jubjubが耐性があることを確認しました。

- *Rhoメソッド* [[Blake-Seroussi-Smart, Section V.1]](https://www.cambridge.org/core/books/elliptic-curves-in-cryptography/16A2B60636EFA7EBCC3D5A5D01F28546): Rhoメソッドのコストが平均して約`0.886*sqrt(l)`加算になることを要求します。これは`2^100`以上である必要があります。
- *加法的および乗法的転送* [[Blake-Seroussi-Smart, Section V.2]](https://www.cambridge.org/core/books/elliptic-curves-in-cryptography/16A2B60636EFA7EBCC3D5A5D01F28546): 埋め込み次数が少なくとも`(l − 1)/100`であることを要求します。
- *高い判別式* [[Blake-Seroussi-Smart, Section IX.3]](https://www.cambridge.org/core/books/elliptic-curves-in-cryptography/16A2B60636EFA7EBCC3D5A5D01F28546): 複素乗法体の判別式`D`が`2^100`より大きいことを要求します。

**楕円曲線暗号**

- *ラダー* [[Montgomery]](https://wstein.org/edu/Fall2001/124/misc/montgomery.pdf): 曲線がモンゴメリーラダーをサポートしていることを確認します。
- *ねじれ* [[SafeCurves, twist]](https://safecurves.cr.yp.to/twist.html): 小さなサブグループ攻撃、無効な曲線攻撃、ねじれ攻撃に対して安全であることを確認します。
- *完全性* [[SafeCurves, complete]](https://safecurves.cr.yp.to/complete.html): 曲線が単一スカラーと複数スカラーの完全な式を持っていることを確認します。
- *区別不可能性* [[IACR2013/325]](https://eprint.iacr.org/2013/325): 楕円曲線上の点を一様ランダムな文字列と区別できないマップが利用可能であることを確認します。

## テストケース

**テスト1 (加算)**

点``P1 = (x1, y1)``と``P2 = (x2, y2)``の座標を以下のように考えます:
```
x1 = 17777552123799933955779906779655732241715742912184938656739573121738514868268
y1 = 2626589144620713026669568689430873010625803728049924121243784502389097019475

x2 = 16540640123574156134436876038791482806971768689494387082833631921987005038935
y2 = 20819045374670962167435360035096875258406992893633759881276124905556507972311
```
その和 `` P1+P2 = (x3, y3)`` は以下のようになります:
```
x3 = 7916061937171219682591368294088513039687205273691143098332585753343424131937
y3 = 14035240266687799601661095864649209771790948434046947201833777492504781204499
```

**テスト2 (倍加算)**

点``P1 = (x1, y1)``と``P2 = (x2, y2)``の座標を以下のように考えます:
```
x1 = 17777552123799933955779906779655732241715742912184938656739573121738514868268,
y1 = 2626589144620713026669568689430873010625803728049924121243784502389097019475

x2 = 17777552123799933955779906779655732241715742912184938656739573121738514868268
y2 = 2626589144620713026669568689430873010625803728049924121243784502389097019475
```
その和 `` P1+P2 = (x3, y3)`` は以下のようになります:
```
x3 = 6890855772600357754907169075114257697580319025794532037257385534741338397365
y3 = 4338620300185947561074059802482547481416142213883829469920100239455078257889
```

**テスト3 (恒等元の倍加算)**

点``P1 = (x1, y1)``と``P2 = (x2, y2)``の座標を以下のように考えます:
```
x1 = 0
y1 = 1

x2 = 0
y2 = 1
```
その和 `` P1+P2 = (x3, y3)`` は同じ点になります:
```
x3 = 0
y3 = 1
```

**テスト4 (曲線上の点)**

点``(0,1)``はBaby Jubjub上の点です。

点``(1,0)``はBaby Jubjub上の点ではありません。

**テスト5 (ベース点の選択)**

ベース点 `` B = (Bx, By)`` の座標が

```
Bx = 5299619240641551281634865583518297030282874472190772894086521144482721001553
By = 16950150798460657717958625567821834550301663161624707787222815936182638968203
```
であり、これがジェネレータ点 ``G = (Gx, Gy)`` の8倍であることを確認します。ここで
``` 
Gx = 995203441582195749578291179787384436505546430278305826713579947235728471134
Gy = 5472060717959818805561601436314318772137091100104008585924551046643952123905
```
つまり、``B = 8 x G``であることを確認します。

**テスト6 (ベース点の位数)**

ベース点 `` B = (Bx, By)`` の座標が

```
Bx = 5299619240641551281634865583518297030282874472190772894086521144482721001553
By = 16950150798460657717958625567821834550301663161624707787222815936182638968203
```
であり、これに`l`を乗じると原点`O = (0, 1)`になることを確認します。このテストは、ベース点`B`の位数が`l`であることを確認するものです。

## 実装

Baby Jubjubの算術演算と、曲線を使用した暗号プリミティブのいくつかは、さまざまな言語で既に実装されています。以下にいくつかの実装例を示します:

- Python: https://github.com/barryWhiteHat/baby_jubjub_ecc
- JavaScript: https://github.com/iden3/circomlib/blob/master/src/babyjub.js
- 回路(circom): https://github.com/iden3/circomlib/blob/master/circuits/babyjub.circom
- Rust: https://github.com/arnaucube/babyjubjub-rs
- Solidity: https://github.com/yondonfu/sol-baby-jubjub
- Go: https://github.com/iden3/go-iden3-crypto/tree/master/babyjub

## 著作権
著作権およびその関連権利は[CC0](../LICENSE.md)により放棄されています。