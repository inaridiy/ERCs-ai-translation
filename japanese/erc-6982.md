---
original: 48f4095d688507e3733f8f3e6bfdca060d5f90c5ea4230fb1aed72ce806d738b
---

---
eip: 6982
title: 効率的なデフォルトロック可能なトークン
description: ERC-721トークンのロック可能な効率的なアプローチ
author: Francesco Sullo (@sullof), Alexe Spataru (@urataps)
discussions-to: https://ethereum-magicians.org/t/erc721-default-lockable-proposal/13366
status: 最終
type: 標準トラック
category: ERC
created: 2023-05-02
requires: 165, 721
---

## 概要

この提案では、不要なイベントを排除することで、ガス使用量を最適化した[ERC-721](./eip-721.md)トークンのロック可能なインターフェースを紹介します。このインターフェースは、ロック可能な[ERC-721](./eip-721.md)トークンの作成と管理の基礎を形成します。デプロイ時に`DefaultLocked(bool locked)`イベントを発行し、すべてのトークンの初期ロック状態を設定することで、ガス効率的なアプローチを提供します。一方で、個別の`Locked(uint256 indexed tokenId, bool locked)`イベントは、特定のトークンのステータス変更を処理します。このインターフェースには、トークンの現在のロック状態を返す`locked(uint256 tokenId)`ビュー関数と、新しくミントされたトークンのデフォルトステータスを照会する`defaultLocked()`ビュー関数も含まれています。

## 動機

既存のロック可能なトークンの提案では、トークンがミントされるたびにイベントを発行することが義務付けられています。これは、トークンが永久にロックされたままの場合(ソウルバウンドやトランスファー不可能なバッジなど)、特に無駄なガス消費につながります。この提案は、コントラクトのデプロイ時とトークンの個別ステータス変更時にのみイベントを発行する、より効率的なソリューションを提供します。

## 仕様

この文書の中の「MUST」、「MUST NOT」、「REQUIRED」、「SHALL」、「SHALL NOT」、「SHOULD」、「SHOULD NOT」、「RECOMMENDED」、「NOT RECOMMENDED」、「MAY」、「OPTIONAL」というキーワードは、RFC 2119およびRFC 8174に記載されているように解釈されるものとします。

インターフェースは以下のように定義されます:

```solidity
// ERC165 interfaceId 0x6b61a747
interface IERC6982 {
  /**
   * @dev コントラクトのデプロイ時に、すべてのトークンのデフォルトロック状態を確立するために発行されなければなりません。
   *      また、デフォルトロック状態が変更された場合にも再度発行されなければなりません。これにより、
   *      (特定の`Locked`イベントがない)すべてのトークンのデフォルト状態が更新されることが保証されます。
   */
  event DefaultLocked(bool locked);

  /**
   * @dev 特定のトークンのロック状態が変更された場合に発行されなければなりません。
   *      このステータスは、そのトークンのデフォルトロック状態を上書きします。
   */
  event Locked(uint256 indexed tokenId, bool locked);

  /**
   * @dev トークンのデフォルトロック状態を返します。
   *      返される値は、最新の`DefaultLocked`イベントで示されたステータスを反映しなければなりません。
   */
  function defaultLocked() external view returns (bool);

  /**
   * @dev 特定のトークンのロック状態を返します。
   *      そのトークンに対して`Locked`イベントが発行されていない場合は、現在のデフォルトロック状態を返さなければなりません。
   *      トークンが存在しない場合は、関数がrevertしなければなりません。
   */
  function locked(uint256 tokenId) external view returns (bool);
}
```

[ERC-165](./eip-165.md)のinterfaceIdは`0x6b61a747`です。

## 根拠

この標準は、イベントの発行頻度を最小限に抑えることでガス消費を最適化することを目的としています。`DefaultLocked`イベントは、すべてのトークンのロック状態を確立するために設計されており、新しいトークンがミントされるたびにイベントを発行する必要がなくなります。`DefaultLocked`イベントは、任意の時点で発行できることに注意が必要です。`Locked`イベントが発行される前に限定されるものではありません。

トークンの動作が特定の状況(例えば、リベールの後)で変更される場合、新しいデフォルト状態を反映するために`DefaultLocked`イベントを再度発行する必要があります。ここでの主な目的は、デフォルト状態が変更された際に、個別の`Locked`イベントを発行する必要がなくなることで、ガス使用量を節約することです。

`Locked`イベントは、個別のトークンのロック状態の変更を記録するために使用されます。

`defaultLocked`関数は、トークンの現在のデフォルトロック状態を返します。この関数は、他のコントラクトとの連携を促進し、[ERC-5192](./eip-5192)との潜在的な競合を回避するのに役立ちます。

`locked`関数は、特定のトークンIDの現在のロック状態を返します。これにより、他のコントラクトとの連携がさらに容易になります。特定のトークンIDに変更がない場合、この関数は`defaultLocked`関数の値を返す必要があります。

トークンが「ロック」されていることは、必ずしも完全に譲渡不可能であることを意味するわけではないことに注意が必要です。一定の条件の下では、ロックされたトークンでも譲渡できる可能性があります。主に、ロックされた状態は、マーケットプレイスや外部取引所でのトークンの譲渡可能性に関連しています。

例として、Crunaプロトコルを考えてみましょう。このシステムでは、NFTの所有者が「プロテクター」と呼ばれる二次的なウォレットを有効化する機能があります。プロテクターを設定すると、トークンのステータスは「ロック」されます。ただし、この「ロック」は、指定されたプロテクターからの譲渡の開始を妨げるものではありません。

## 下位互換性

この標準は、既存の[ERC-721](./eip-721.md)コントラクトとの完全な下位互換性を持っています。既存のコントラクトに簡単に統合でき、競合や混乱を引き起こすことはありません。

## 参考実装

サンプル実装は[assets](../assets/eip-6982)ディレクトリにあります。

これは特定のユースケースを解決しています:トークンの所有者がプールにアセットをステーキングしたときに所有権を失うという問題です。この実装により、プールがアセットをロックできるようになり、所有権は所有者に残ります。[README](../assets/eip-6982/README.md)には、コントラクトのコンパイルとテストの方法についての詳細が記載されています。

## セキュリティ上の考慮事項

この EIPは、既知のセキュリティ上の問題を導入していません。ただし、任意のスマートコントラクト標準と同様に、このインターフェースの実装においては、厳格なセキュリティ対策を講じることが重要です。

## 著作権

著作権およびそれに関連する権利は[CC0](../LICENSE.md)によって放棄されています。