---
original: 687007c9641c2d49fe73fdddd18f743b3690755549b3228a684eb2dd5f5982a9
---

---
eip: 4885
title: サブスクリプションNFTとマルチトークン
description: NFTとマルチトークンのサブスクリプションを提供するインターフェース
author: Jules Lai (@julesl23)
discussions-to: https://ethereum-magicians.org/t/eip-subscription-token-standard/8531
status: 停滞
type: Standards Track
category: ERC
created: 2022-03-08
requires: 165, 721, 1155
---

## 概要

以下の標準では、非代替性トークン(NFT)とマルチトークンのサブスクリプションのための標準APIの実装を可能にします。[EIP-20](./eip-20.md)トークンは、有期限または無期限のサブスクリプションを提供する権利を与えるサブスクリプショントークンと交換に預金されます。

## 動機

この標準は、[EIP-721](./eip-721.md)または[EIP-1155](./eip-1155.md)コントラクトが提供する資産やサービスにサブスクライブするための柔軟で汎用的な方法を提供します。以下では、簡単のため、これらのコントラクトをNFTと呼びます。プロバイダーはこれらのNFTの発行者で、サブスクライバー(ら)はそれらを使用します。

この提案は、音楽やフィルムのクリエイターに制御権を戻すという要望から生まれました。デジタルコンテンツの配布と配信は現在、顧客に均一なサブスクリプションモデルを提供する中央集権的なテクノロジー企業の管轄下にあります。この提案は、クリエイターが独自のカスタムサブスクリプションモデルを設定できるようにするための標準を定めており、分散型の配布と配信モデルにつながる新しい収益源を生み出すことができます。

使用例には、以下のようなものが含まれます:

- 音楽、動画、eラーニング、書籍/ニュースサービスの定期的(例:毎日、毎週、毎月、四半期ごと、年間/年次、または季節ごと)なサブスクリプション
- サブスクライバー間での デジタルアセットの共有
- ヘルスクラブなどのメンバーシップ
- スポーツやeスポーツのシーズンチケット
- DeFiでの固定レートサブスクリプションストリームと変動収入の交換
- ゲーム内アセットのレンタル
- など

サブスクリプショントークンはEIP-20仕様からいくつかの関数を借用しています。実装者は標準の残りの部分を自由に実装できます。これにより、サブスクリプショントークンを二次市場で転送したり、ギフトとして送ったり、払い戻しに使ったりすることができます。

## 仕様

サブスクライバーはEIP-20を預金してNFTとサブスクリプションを受け取ります。サブスクリプショントークンの残高は、NFTの使用期間に応じて線形に自動的に減少し、残高がゼロになるとNFTの使用が無効になります。サブスクライバーは、EIP-20トークンをさらに預金してサブスクリプションの有効期間を延長することができます。

このEIP標準を実装するスマートコントラクトは、[EIP-165](./eip-165.md)のsupportsInterfaceメソッドを実装し、引数interfaceIDに0xC1A48422が渡された場合に、定数値trueを返さなければなりません。この文書におけるrevertは、require、throw(非推奨)、またはエラーメッセージの有無に関わらずrevertステートメントを意味する可能性があります。

```solidity
interface ISubscriptionToken {
    /**
        @dev サブスクリプショントークンのコンストラクタまたはイニシャライズメソッドが
        実行されたときに発行されます。
        @param name サブスクリプショントークンの名称
        @param symbol サブスクリプショントークンのシンボル
        @param provider サブスクリプションを提供するプロバイダー
        @param subscriptionToken サブスクリプショントークンのコントラクトアドレス
        @param baseToken 預金に使用するERC-20互換トークン。
        @param nft サブスクリプションプロバイダーがミントまたは転送するNFTコントラクトのアドレス。
        このインターフェースで言及されるすべてのtokenIdは、このnftコントラクトのトークンインスタンスでなければなりません。
    */
    event InitializeSubscriptionToken(
        string name,
        string symbol,
        address provider,
        address indexed subscriptionToken,
        address indexed baseToken,
        address indexed nft,
        string uri
    );

    /**
        @dev `nft`コントラクトのトークン`tokenId`に新しいサブスクライバーが登録されるたびに発行されます。
        `subscriber`は`nft`のトークン`tokenId`をアカウントで受け取っている必要があります。
        @param subscriber サブスクライバーのアカウント
        @param tokenId `subscriber`に送られた`nft`のトークンID
        @param uri `subscriber`に送られた`nft`のURIまたは空文字列
    */
    event SubscribeToNFT(
        address indexed subscriber,
        uint256 indexed tokenId,
        string uri
    );

    /**
        @dev `subscriber`が`baseToken`タイプのERC-20を`deposit`メソッドで預金したときに発行されます。
        これにより、`subscriber`のサブスクリプショントークンの残高が増加します。
        @param depositAmount 預金したERC-20の`baseToken`の量
        @param subscriptionTokenAmount `subscriber`に送られたサブスクリプショントークンの量
        @param subscriptionPeriod 追加されたサブスクリプション期間(秒)
    */
    event Deposit(
        address indexed subscriber,
        uint256 indexed tokenId,
        uint256 depositAmount,
        uint256 subscriptionTokenAmount,
        uint256 subscriptionPeriod
    );

    /**
        @return サブスクリプショントークンの名称
    */
    function name() external view returns (string memory);

    /**
        @return サブスクリプショントークンのシンボル
    */
    function symbol() external view returns (string memory);

    /**
        @notice `subscriber`を`tokenId`の`nft`にサブスクライブさせます。`subscriber`は`tokenId`の`nft`をアカウントで受け取っている必要があります。
        @dev `subscriber`がすでに`tokenId`の`nft`にサブスクライブしている場合はrevertしなければなりません。
        `nft`が`subscriptionToken`コントラクトアドレスをオペレーターとして承認していない場合はrevertしなければなりません。
        @param subscriber サブスクライバーのアカウント。ゼロアドレスの場合はrevertしなければなりません。
        @param tokenId `subscriber`に送られた`nft`コントラクトのトークンID
        `SubscribeToNFT`イベントから発行されるtokenIdと同じでなければなりません。ただし、tokenIdがゼロの場合は、内部的に設定され`nft`コントラクトによってミントされる任意のtokenIdを許可します。
        @param uri `nft`のオプションのURI。
        `SubscribeToNFT`イベントから発行されるuriと同じでなければなりません。ただし、uriが空の場合は例外。
    */
    function subscribeToNFT(
        address subscriber,
        uint256 tokenId,
        string memory uri
    ) external;

    /**
        @notice `subscriber`が保有するサブスクリプショントークンの残高を増やす
        @dev `subscriber`が`tokenId`の`nft`にサブスクライブしていない場合はrevertしなければなりません。
        `nft`が`subscriptionToken`コントラクトアドレスをオペレーターとして承認していない場合はrevertしなければなりません。
        @param subscriber サブスクライバーのアカウント。ゼロアドレスの場合はrevertしなければなりません。
        @param tokenId サブスクライブする`nft`コントラクトのトークンID
        @param depositAmount `baseToken`コントラクトアドレスのERC-20トークンの預金量。`subscriptionToken`コントラクトアドレスのサブスクリプショントークンと交換されます。
    */
    function deposit(
        address subscriber,
        uint256 tokenId,
        uint256 depositAmount
    ) external payable;

    /**
        @return `subscriber`が保有するサブスクリプショントークンの残高。
        有期限のサブスクリプションでは、残高が時間とともに線形にゼロまで減少することが推奨されます。
        終身のサブスクリプションでは、残高が一定であることが推奨されます。
        `subscriber`が`tokenId`の`nft`を保有していない場合は、ゼロ残高を返さなければなりません。
        `deposit`関数を介してサブスクリプションが開始されていない場合はrevertしなければなりません。
        残高がゼロになると、`subscriber`による`tokenId`の`nft`の使用は許可されません。
    */
    function balanceOf(address subscriber) external view returns (uint256);
}
```

### サブスクリプショントークンの残高

一例として、サブスクリプション期間の長さに応じて1日あたり1つのサブスクリプショントークンが合計されるように、サブスクリプショントークンをミントする実装が考えられます。例えば1週間であれば7つのサブスクリプショントークンになります。サブスクリプショントークンの残高は、時間とともに1トークンずつ連続的かつ線形に自動的に減少し、ゼロになります。`balanceOf`関数は、呼び出し時にのみ残高を計算するように遅延実装できるため、ガスコストはかかりません。

### サブスクリプショントークンの価格

サブスクリプショントークンの1トークンあたりの秒単位の価格は、`Deposit`イベントのパラメータから計算できます:
`depositAmount` / (`subscriptionTokenAmount` \* `subscriptionPeriod`)

### NFTのメタデータ

NFTのメタデータには、プロバイダーがサブスクライバーに提供するアセット/サービスの情報を格納できます。これには、プロバイダーがサブスクライバーに提供するサブスクリプションサービスの利用規約などが含まれる可能性があります。また、NFTアセットのメタデータそのものが提供される場合もあります。この標準は、NFTの様々な使用例に対応するため、あえて一般的に設計されています。

### サブスクリプションの期限切れ

サブスクライバーのサブスクリプショントークンの残高がゼロになった場合(サブスクリプションが期限切れになったことを示す)、実装者がその特定の使用例に応じてどのように対応するかは任意です。例えば、プロバイダーがサブスクライバーにメディアサービスの配信を停止する、オフチェーンに保存された画像のNFTの`uri`関数が空の文字列を返すなどが考えられます。

### 注意点

伝統的な法定通貨ベースのサブスクリプションモデルでは、サブスクリプションの期限が切れる直前や直後に、サブスクライバーの保存された支払い情報を使って自動的に延長購入が行われます。この機能は、この提案の仕様では実現できません。暗号通貨を使う場合、各支払いにつき、サブスクライバーによる署名付きの許可が必要になります。

この提案では、サブスクリプションの一時停止を直接扱いません。実装者は独自の実装を行うか、OpenZeppelinのPausableなどの第三者のスマートコントラクト抽象化を継承することができます。その場合、`balanceOf`メソッドには、サブスクリプショントークンが一時停止されていた期間の長さを考慮する追加のロジックとストレージが必要になります。

## 根拠

### サブスクリプションのトークン化

サブスクリプション自体は預金と交換される価値があります。この提案により、サブスクリプションを「トークン化」することで、二次市場でサブスクリプショントークンを買い売りできるようになります。例えば、ファンが生スポーツイベントへのアクセスを提供するシーズンチケットを他のファンに売りたい場合などです。これは、NFTに単なる有効期限の延長機能を追加するだけでは実現できません。

実装者は、EIP-20の残りの関数を簡単に実装することで、サブスクリプショントークンを取引できるようにすることができます。サブスクリプションサービスが非代替性か代替性かは、実装者が決めることができます。非代替性の場合、サブスクリプショントークンを購入すれば、残りの期間が同じになります。代替性の場合で、購入者が同じサービスの既存のサブスクリプションを持っていれば、購入したサブスクリプショントークンの分だけ、合計のサブスクリプション期
間を延長できます。

### 現在および将来のNFTの使用に対応

この提案では、`subscribeToNFT`メソッドの`tokenId`と`uri`をオプションにすることで、汎用性を持たせています。事前に計算されたイメージのNFTコレクションのような一部のユースケースでは、`uri`が異なる必要はなく、`tokenId`だけが異なればよいでしょう。一方、法的契約情報を NFTのメタデータに保存する必要があるユースケースでは、個別の`uri`リンクが必要になる可能性があります。

### ユーザーに制御権を戻す

特に動画配信サービスなどの従来のサブスクリプションモデルでは、サブスクリプションモデルの制御は完全に中央集権的なサービスプロバイダーにあります。この提案は、分散型サービスにユーザーに制御権を戻す標準的な方法を提供します。したがって、各ユーザーは独自のサブスクリプションエコシステムを開発し、ユーザー自身とサブスクライバーのニーズに合ったものを管理することができます。

## 下位互換性

サブスクリプショントークンコントラクトは、EIP-20仕様と完全に互換性を持つことができ、例えばサブスクライバー間での転送が可能になります。EIP-20の`name`、`symbol`、`balanceOf`メソッドは、この提案の仕様の一部となっており、実装者は自身のユースケースを考慮して、EIP-20のインターフェースの残りの部分を実装するかどうかを選択できます。

サブスクリプショントークンの使用は、NFTの有効期間を間接的に制御する方法です。したがって、NFTとサブスクリプショントークンコントラクトが同じプラットフォームまたは分散型アプリケーションによってデプロイされた場合に最も効果的に機能すると考えられます。既存のNFTがサブスクリプショントークンをオペレーターとして承認していない場合、影響を与えたり依存関係を持ったりしてはいけません。そのため、この提案では、'nft'が`subscriptionToken`コントラクトアドレスをオペレーターとして承認している必要があると指定しています。

## セキュリティ上の考慮事項

サービスプロバイダーが、サブスクライバーがサービスを利用する前に前払いを受け取るのは一般的です。この提案の`deposit`メソッドもこの方式に従っています。したがって、サービスプロバイダーが設定し、預金を受け取った後、サービスを提供しないか、品質の悪いサービスを提供する可能性があります。これは従来の世界でも起こりうることであり、この提案ではこれを解決する方法は扱っていません。

`subscribeToNFT`メソッドは`uri`パラメータを取りますが、これが中央集権的なストレージに保存されている場合、所有者が メタデータを変更したり、メタデータが攻撃を受けたりする可能性があります。これはバニラのNFTコントラクトでも同じ問題です。しかし、`uri`がデプロイ時ではなくサブスクリプション時に提供されるため、ユースケースによっては、実装者がuriリンクを不変のストレージに保存することが推奨されます。

## 著作権

著作権およびそれに関連する権利は[CC0](../LICENSE.md)により放棄されています。