---
original: 7119f43e22f611d5207482530bdc01e634ef4ab687ebde461c20fa6c2acfc334
---

---
eip: 7512
title: 監査のオンチェーン表現
description: 監査レポートの契約可読表現を定義する提案。
author: Richard Meissner - Safe (@rmeissner)、Robert Chen - OtterSec (@chen-robert)、Matthias Egli - ChainSecurity (@MatthiasEgli)、Jan Kalivoda - Ackee Blockchain (@jaczkal)、Michael Lewellen - OpenZeppelin (@cylon56)、Shay Zluf - Hats Finance (@shayzluf)、Alex Papageorgiou - Omniscia (@alex-ppg)
discussions-to: https://ethereum-magicians.org/t/erc-7512-onchain-audit-representation/15683
status: Draft
type: Standards Track
category: ERC
created: 2023-09-05
requires: 712
---


## 概要

この提案は、監査レポートのオンチェーン表現の標準を作成することを目的としています。これにより、契約がどの監査を実施したか、どの基準が検証されたかなどの関連情報を抽出できるようになります。

## 動機

監査はスマートコントラクトのセキュリティフレームワークの不可欠な一部です。[ERC-20](./eip-20.md)、[ERC-721](./eip-721.md)、および同様のERCなどの最良の実践に従い、正しく実装されていることを確認するために一般的に使用されています。ブロックチェーンエコシステムの多くの重要な部分がスマートコントラクトによって実現されています。その例は以下のとおりです:

- ブリッジ: ほとんどのブリッジはブリッジヘッドまたはロックボックスで構成されており、ブリッジされるトークンを確保しています。これらのコントラクトに不具合がある場合、ブリッジの運用を停止したり、極端な場合には無担保のアセットがサテライトチェーンで発行される可能性があります。
- トークンコントラクト: Ethereumエコシステムのすべてのトークンはスマートコントラクトです。これらのトークンと対話するアプリは、[ERC-20](./eip-20.md)および[ERC-721](./eip-721.md)などの既知のトークン標準に準拠していることを前提としています。異なる動作をするトークンは予期せぬ動作を引き起こし、資金の損失につながる可能性があります。
- スマートコントラクトアカウント(SCA): [ERC-4337](./eip-4337.md)により、スマートコントラクトベースのアカウントに対するより多くの可視性が生み出されています。SCは極端な柔軟性を提供し、各アカウントに対してより高度な制御と安全性を維持しながら、さまざまなユースケースに対応できます。実験されているコンセプトの1つは、スマートコントラクトアカウントの機能を拡張するモジュールの概念です。[ERC-6900](./eip-6900.md)は、アカウントに登録およびデザインできるプラグインを定義する最近の標準です。
- 相互運用性(フックとコールバック): 外部関数との対話をサポートするプロトコルが増え、[ERC-1155](./eip-1155.md)のようなトークン標準がトランスファー時にコールバックをトリガーするようになったため、これらの相互作用が十分に検証されて、関連するセキュリティリスクを最小限に抑えることが重要です。

スマートコントラクトの使用と影響は日々の分散型アプリケーションの運用に着実に増加していきます。セキュリティについての具体的な保証を提供し、よりよい相互運用性を可能にするために、特定のコントラクトが監査されたことを検証する方法がオンチェーンで存在することが不可欠です。監査が行われたことを検証するシステムを構築することで、スマートコントラクトエコシステム全体のセキュリティ保証が強化されます。

ただし、この情報だけでは、コントラクトにバグや欠陥がないことを保証するものではありません。スマートコントラクトのセキュリティシステムを構築する上で重要な基盤を提供することができます。

### 例

仮想的な[ERC-1155](./eip-1155.md)トークンブリッジを考えてみましょう。スケーラブルなシステムを作成し、ブリッジできる新しいトークンを簡単に登録できるようにすることが目標です。悪意のあるまたは不具合のあるトークンが登録されるリスクを最小限に抑えるために、監査を使用し、オンチェーンで検証します。

![オンチェーン監査の使用例](../assets/eip-7512/example_use_case.png)

図の流れを明確に説明するために、ブリッジとバリデーターの役割を別の主体に分けています。理論的には、両者は同じコントラクトに存在することができます。

4つの当事者がいます:

- ユーザー: トークンをブリッジしたいエンドユーザー
- ブリッジオペレーター: ブリッジを管理するオペレーター
- ブリッジ: ユーザーがブリッジ操作をトリガーするコントラクト
- バリデーター: トークンを登録できるかどうかを検証するコントラクト

最初の(1)ステップとして、ブリッジオペレーターは、トークン登録プロセスで受け入れられる監査人のキー/アカウントを定義する必要があります。

これにより、ユーザー(またはトークンの所有者)は登録フローをトリガーできます(2)。2つのステップ(3と6)が実行されます: 提供された監査が有効であり、信頼できる監査人によって署名されていることを確認する(4)、およびトークンコントラクトがブリッジでサポートされているトークン標準([ERC-1155](./eip-1155.md))を実装していることを確認する(7)。

監査とトークン標準の検証が完了したら、オペレーターによる手動の介入(10)を行うことをお勧めします。 <!-- この手順は、監査人を強く信頼している場合や、ERCが強い互換性保証を提供する場合は省略できます。 -->

トークンがブリッジで有効化されると、ユーザーはそれをブリッジできるようになります(11)。

## 仕様

この文書の「MUST」、「MUST NOT」、「REQUIRED」、「SHALL」、「SHALL NOT」、「SHOULD」、「SHOULD NOT」、「RECOMMENDED」、「NOT RECOMMENDED」、「MAY」、「OPTIONAL」のキーワードは、RFC 2119およびRFC 8174に記載されているように解釈されるものとします。

### 監査プロパティ

- 監査人
    - `name`: 監査人の名前(ユーザーに表示するため)
    - `uri`: 監査人に関する詳細情報を取得するURI
    - `authors`: この監査に貢献した著者のリスト。これは、コントラクトを監査し、監査レポートを作成した人物である必要があります。
- 監査
    - `auditor`: 監査人に関する情報
    - `auditedContract`: 監査の対象となったコントラクトの`chainId`と`deployment`を含む必須項目
    - `issuedAt`: `auditHash`で識別される元の監査が発行された時期を含む必須項目
    - `ercs`: 対象コントラクトが実装しているERCのリスト。リストされたERCは完全に実装されている必要があります。このリストは空にすることができます。
    - `auditHash`: 元の監査のハッシュ。これにより、特定の監査に属する情報のオンチェーン検証が可能になります。
    - `auditUri`: 監査を取得できるソースを指すべきです。
- コントラクト
    - `chainId`: コントラクトがデプロイされているブロックチェーンの[EIP-155](./eip-155.md)チェーンIDの`bytes32`表現
    - `deployment`: コントラクトのデプロイアドレスの`address`表現

### 監査人の検証

- 署名
    - タイプ
        - `SECP256K1`
            - データは`r`、`s`、`v`のエンコード表現
        - `BLS`
            - TBD
        - `ERC1271`
            - データは`chainId`、`address`、`blocknumber`、`signature bytes`のABIエンコード表現
        - `SECP256R1`
            - データは`r`、`s`、`v`のエンコード表現
    - データ

### データ型

```solidity
struct Auditor {
    string name;
    string uri;
    string[] authors;
}

struct Contract {
    bytes32 chainId;
    address deployment;
}

struct AuditSummary {
    Auditor auditor;
    uint256 issuedAt;
    uint256[] ercs;
    Contract auditedContract;
    bytes32 auditHash;
    string auditUri;
}
```

### 署名

[EIP-712](./eip-712.md)が使用されます。メインの型は`AuditSummary`で、`EIP712Domain`は以下の定義が適用されます:

```solidity
struct EIP712Domain {
    string name;
    string version;
}

EIP712Domain auditDomain = EIP712Domain("ERC-7652: Onchain Audit Representation", "1.0");
```

生成された署名を`AuditSummary`に添付して、新しい`SignedAuditSummary`オブジェクトを生成できます:

```solidity
enum SignatureType {
    SECP256K1,
    BLS,
    ERC1271,
    SECP256R1
}

struct Signature {
    SignatureType type;
    bytes data;
}

struct SignedAuditSummary extends AuditSummary {
    uint256 signedAt;
    Signature auditorSignature;
}
```

## 根拠

現在のERCでは、監査の「所見」を定義していません。そのような定義には、サポートされる重大度の定義、所見のオンチェーン対オフチェーンでの保存方法、および他の同様の所見関連の属性を厳密に記述することが必要となり、これは非常に複雑な作業です。この作業の複雑さを考慮し、この作業はこのEIPの範囲外と見なされます。重要なのは、このERCは、特定のコントラクトインスタンス(その`chainId`と`deployment`によって指定)が安全性監査を受けたことを示すものであり、そのコントラクトインスタンスが一覧表示されたERCを正しく実装していることを示すものであるということです。

通常、これは契約のための最終的な監査改訂版に対応し、デプロイメントに関連付けられます。上記のように、このERCはコントラクトのセキュリティを保証するものではなく、スマートコントラクトに関連するデータを抽出する方法論を提供するものと見なされるべきです。データの品質、カバレッジ、および保証の評価は、ERCの利用者に委ねられます。

### その他の考慮事項

- `standards`vs`ercs`
    - EVM ベースのスマートコントラクトアカウントに関連する監査に範囲を限定することで、パラメーターをより良く定義できます。
- `chainId`と`deployment`
    - コントラクトの動作はデプロイされているブロックチェーンに依存するため、監査に関連付けられる`chainId`と`deployment`アドレスを組み合わせることにしました。
- `contract`vs`contracts`
    - 多くの監査は、プロトコルを構成する複数のコントラクトに関連しています。この初期バージョンのERCの簡単さを確保するために、監査要約につき1つのコントラクトのみを参照することにしました。同じ監査業務で複数のコントラクトが監査された場合、同じ監査要約を異なるコントラクトインスタンスに関連付けることができます。このアプローチの主な利点は、監査人による複数の署名パスを適切に関連付けられることです。主な欠点は、監査人による複数の署名パスが必要になることです。
- なぜ[EIP-712](./eip-712.md)?
    - [EIP-712](./eip-712.md)は(署名のための)ツールとの互換性があるため、ベースとして選択されました。
- 監査人に特定の署名キーをどのように割り当てるか?
    - 監査人は公開鍵の部分を公開する必要があり、これはウェブサイト、プロフェッショナルページ、SNSなどで行うことができます。
    - このERCの拡張として、公開リポジトリを構築することも可能ですが、これはERCの範囲外です。
- ポリモーフィックコントラクトとプロキシ
    - このERCは明示的にポリモーフィックコントラクトとプロキシについて言及していません。これらは重要な考慮事項ですが、適切な管理は監査人および本ERCの実装者に委ねられます。

### 将来の拡張

- EVM以外のチェ
インへの対応の可能性
- ポリモーフィック/アップグレード可能なコントラクトおよび複数コントラクトの監査のためのより良いサポート
- 監査人の署名キーの管理
- 監査の所見の定義

## 下位互換性

現在のERC標準との下位互換性の問題は特定されていません。

## 参考実装

TBD。

以下の機能が参考実装に実装されます:

- 監査要約を表す JSONに基づいて署名をトリガーするスクリプト
- 署名された監査要約を検証するコントラクト

## セキュリティ上の考慮事項

### 監査人のキー管理

このERCの前提は、システムに参加する監査人による適切なキー管理にあります。監査人のキーが侵害された場合、標準に準拠していないはずのコントラクトが監査済みであるかのように見なされる可能性があります。潜在的な保護策として、監査人(監査会社など)の「協会」を定義し、監査人のキー侵害の際に、二次的なセキュリティ対策として既存の署名を取り消すことを許可することが考えられます。

## 著作権

著作権およびそれに関連する権利は[CC0](../LICENSE.md)で放棄されています。