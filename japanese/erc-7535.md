---
original: 754d348416e8afe83d9321fba86641a994c673903a996e48cac1b93702ca7824
---

---
eip: 7535
title: ネイティブアセットERC-4626トークン化ボールト
description: 基礎資産としてイーサ(ネイティブアセット)を持つERC-4626トークン化ボールト
author: Joey Santoro (@joeysantoro)
discussions-to: https://ethereum-magicians.org/t/eip-7535-eth-native-asset-tokenized-vault/16068
status: Final
type: Standards Track
category: ERC
created: 2023-10-12
requires: 20, 4626, 7528
---

## 概要

このスタンダードは[ERC-4626](./eip-4626.md)仕様の拡張で、イーサまたはネイティブアセットを基礎資産として扱うための同一のインターフェースと動作オーバーライドを持っています。

## 動機

ETHボールトのためのトークン化標準には、[ERC-4626](./eip-4626.md)と同様の利点があります。特に流動性ステーキングトークン(つまり、ETHステーキングの[ERC-20](./eip-20.md)ラッパー)の場合がそうです。

ERC-4626と全く同じインターフェースを維持することで、その利点をさらに高めることができます。既存のERC-4626ツールやプロトコルとの最大限の互換性が得られるためです。

## 仕様

すべての[ERC-7535](./eip-7535.md)トークン化ボールトは、以下で指定された`asset`、`deposit`、`mint`メソッドの動作オーバーライドを含む、ERC-4626(およびERC-20)を実装しなければなりません。

### ERC-4626の破壊的変更

* `assets`の数量はERC-20残高ではなく、イーサのweiを指します。
* ERC-20の`transfer`呼び出しは、イーサ転送(`send`または`call`)に置き換えられます。
* `asset`のERC-20 `transferFrom`承認フローは実装されていません。
* `deposit`と`mint`は`payable`状態変更を持ちます。
* `deposit`は`msg.value`を主要な入力として使用し、`assets`を無視してもかまいません。

### メソッド

#### asset

[ERC-7528](./eip-7528.md)に従い、`0xEeeeeEeeeEeEeeEeEeEeeEEEeeeeEeeeeeeeEEeE`を返さなければなりません。

```yaml
- name: asset
  type: function
  stateMutability: view

  inputs: []

  outputs:
    - name: assetTokenAddress
      type: address
```

#### deposit

`msg.value`のイーサを正確に預け入れることで、`receiver`に`shares`ボールトシェアを発行します。

`payable`状態変更を持たなければなりません。

`msg.value`を`shares`出力計算の主要な入力パラメータとして使用しなければなりません。つまり、`assets`パラメータを入力として無視してもかまいません。

`Deposit`イベントを発行しなければなりません。

(預入限度に達したり、スリッページなどにより)`msg.value`全額を預け入れられない場合は、リバートしなければなりません。

```yaml
- name: deposit
  type: function
  stateMutability: payable

  inputs:
    - name: assets
      type: uint256
    - name: receiver
      type: address

  outputs:
    - name: shares
      type: uint256
```

#### mint

`assets`のイーサを預け入れることで、正確に`shares`ボールトシェアを`receiver`に発行します。

`payable`状態変更を持たなければなりません。

`Deposit`イベントを発行しなければなりません。

(預入限度に達したり、スリッページ、ユーザーがボールト契約に十分なイーサを送金していないなどにより)`shares`全額を発行できない場合は、リバートしなければなりません。

```yaml
- name: mint
  type: function
  stateMutability: payable

  inputs:
    - name: shares
      type: uint256
    - name: receiver
      type: address

  outputs:
    - name: assets
      type: uint256
```


### イベント

イベントの使用はERC-4626と完全に同一でなければなりません。

### ラップドETH

ERC-20 `asset`としてラップドETHを使用するERC-4626ボールトは、ERC-7535を実装してはいけません。ERC-7535はネイティブETHにのみ適用されます。

## 根拠

このスタンダードは、ERC-4626との互換性を最大限に高めつつ、インターフェースに関する追加の意見を最小限に抑えるように設計されています。この決定の根拠の例は以下の通りです:

* `deposit`関数への冗長な`assets`入力を維持しつつ、その使用を任意にすること
* `mint`呼び出しにおける`msg.value`と`assets`の関係を強制しないこと
* `fallback`/`__default__`メソッド、追加のボールト関数の可払性、強制的にコントラクトに送信されたETHの処理に関する動作や非動作を強制しないこと

ERC-4626との破壊的な実装レベルの変更は、ERC-20トークンではなくイーサまたはネイティブアセットを使用するためだけのものです。

### Depositでassetsパラメータを無視できるようにすること
`deposit`を行うには常に`msg.value`を渡す必要があるため、これを主要な入力数として扱うのが適切です。`assets`を使用することで、冗長性のためのストリクトな等価性と余分なガスオーバーヘッドを強制するか、異なる値を許可することで危険な状況や未定義の動作を引き起こす可能性があります。

可能な最後のオプションは、`assets`は必ず0でなければならないと要求することですが、これでも実装レベルでの強制に手間がかかり、仕様書に明記されていないことをより簡単に無視できるようになります。

### Mintでmsg.valueがassetsの出力と等しくない場合を許可すること
ユーザーが`mint`呼び出しで少し多すぎるイーサを預け入れる場合があります。このような場合、`msg.value`を`assets`と等しくすることを強制すると、不要なリバートが発生する可能性があります。余分なイーサを返金するか吸収するかは、ボールト実装者の判断に委ねられます。預け入れ側のユーザーには、可能な限り正確な量を預け入れることが求められます。

## 下位互換性

ERC-7535は、関数インターフェースレベルでERC-4626と完全に下位互換性があります。ETHがERC-20準拠ではないため、`msg.value`を`assets`よりも優先するなど、実装レベルの動作が異なります。

他の標準との既知の互換性の問題はありません。

## セキュリティ上の考慮事項

[ERC-4626](./eip-4626.md)のすべてのセキュリティ上の考慮事項に加えて、ボールトアセットとしてETHを持つことにはセキュリティ上の影響があります。

### `call`vs`send`

契約は、ETHを転送する際に`call`を使用する場合、信頼できるERC-20トークンでは可能ではない再入力の脆弱性や任意のコード実行を許す可能性があるため、注意を払う必要があります。

単に少量のガススティペンドで`send`ETHを使うほうが安全です。

実装者は、ETHの転送方法を慎重に決める必要があります。

### 強制的なETH転送

`SELFDESTRUCT`オペコードを使用して、ETHをあらゆるボールトに強制的に送ることができます。実装者は、これがボールトの会計処理に影響を与えないことを検証する必要があります。

同様に、追加の`payable`メソッドも、ボールトの会計処理を乱さないことを確認する必要があります。

### ラップドETH

ERC-4626を実装するスマートコントラクトシステムは、基礎資産としてERC-20のみをサポートし、ERC-7535ではなくラップドETHのERC-20を使用することを検討すべきです。

ERC-4626とERC-7535の微妙な違いは、コードの断片化とセキュリティ上の懸念を引き起こす可能性があります。

ERC-7535の使用例としてより適切なのは、ラップドETHや流動性ステーキングトークンなど、ETHに特化したものです。

## 著作権

著作権およびそれに関連する権利は[CC0](../LICENSE.md)で放棄されています。