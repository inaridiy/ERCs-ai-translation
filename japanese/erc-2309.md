---
original: 35defad575269e8513e5259f980485a69b6205b18543aa0933a37df9fbace734
---

---
eip: 2309
title: ERC-721 連続転送拡張
author: Sean Papanikolas (@pizzarob)
discussions-to: https://github.com/ethereum/EIPs/issues/2309
status: 最終
type: 標準トラック
category: ERC
created: 2019-10-08
requires: 721
---

## 簡単な要約

連続したトークン識別子を使用して、1つまたは複数の非代替性トークンの作成/転送時に発行される標準化されたイベント。

## 概要

オプションの ERC-721 連続転送拡張は、1つまたは複数の非代替性トークンの作成/転送時に発行される標準化されたイベントを提供します。この標準は、多数のトークンの作成/転送方法を定めるものではなく、これらのトークンの作成または所有権の移転後に発行されるイベントに関するものです。この拡張では、トークン識別子が連続順に並んでいることを前提としています。

## 動機

この拡張により、[ERC-721 仕様](./eip-721.md)のスケーラビリティがさらに向上します。1つのトランザクションで2^256の非代替性トークンを作成、転送、焼却することが可能です。しかし、1つのトランザクションで `Transfer` イベントをそれだけ多く発行することはできません。`Transfer` イベントは元の仕様の一部で、以下のように定義されています:

> これは、あらゆるメカニズムによって NFT の所有権が変更されたときに発行されます。
> これはNFTが作成された(`from` == 0)または破棄された(`to` == 0)ときに発行されます。
> 例外: コントラクト作成時、任意の数のNFTを作成および割り当てることができ、Transfer を発行しないことができます。
> 転送時、その NFT の承認アドレス(ある場合)はリセットされます。

これにより、元の `Transfer` イベントが1つのトークンごとに発行されるため、O(n)の時間複雑度が得られます。効率的なデータ構造を使えば、10億個のNFTを1つのトランザクションでミントできますが、`Transfer` イベントを発行するには10億回のループが必要となり、ガス代の上限や取引タイムアウトを超えてしまいます。現在の仕様ではこれは実現できません。この拡張はその問題を解決します。

多くの分散型マーケットプレイスやブロックエクスプローラーは、`Transfer` イベントを使ってアドレスが所有するNFTを特定しています。連続転送拡張は、これらのプラットフォームが多数のトークンの所有権を特定するための標準的な仕組みを提供します。

## 仕様

この文書の「MUST」、「MUST NOT」、「REQUIRED」、「SHALL」、「SHALL NOT」、「SHOULD」、「SHOULD NOT」、「RECOMMENDED」、「MAY」、「OPTIONAL」は、RFC 2119に記載されているように解釈されるものとします。

**ERC-721 準拠のコントラクトは、1つまたは複数の連続したトークンの作成、焼却、転送時に標準的なイベントを発行するために、この連続転送拡張を実装してもよい**

トランザクションを実行するアドレスは、`fromTokenId` と `toTokenId` の範囲内のすべてのトークンの所有者であるか、オーナーに代わって行動する承認済みのオペレーターでなければなりません。

`fromTokenId` と `toTokenId` は、連続したトークンIDの範囲でなければなりません。

`fromTokenId`、`fromAddress`、`toAddress` はインデックス付きパラメーターでなければなりません。

`toTokenId` はインデックス付きパラメーターであってはなりません。

トークンのミント/作成時、`fromAddress` 引数は `0x0` (ゼロアドレス)に設定しなければなりません。

トークンの焼却/破棄時、`toAddress` 引数は `0x0` (ゼロアドレス)に設定しなければなりません。

`ConsecutiveTransfer` イベントを発行する際は、`Transfer` イベントを発行してはなりません。

`ConsecutiveTransfer` イベントを実装するコントラクトは、元の `Transfer` イベントを引き続き使用してもよいですが、`ConsecutiveTransfer` イベントを発行する際は `Transfer` イベントを発行してはなりません。

```solidity
  event ConsecutiveTransfer(uint256 indexed fromTokenId, uint256 toTokenId, address indexed fromAddress, address indexed toAddress);
```

### 例

`ConsecutiveTransfer` イベントは、単一のトークンおよび複数のトークンに使用できます:

**単一トークンの作成**

`emit ConsecutiveTransfer(1, 1, address(0), toAddress);`

**一括トークンの作成**

`emit ConsecutiveTransfer(1, 100000, address(0), toAddress);`

**一括トークンの転送**

`emit ConsecutiveTransfer(1, 100000, fromAddress, toAddress);`

**焼却**

`emit ConsecutiveTransfer(1, 100000, from, address(0));`


## 根拠

`ConsecutiveTransfer` イベントを標準化することで、分散型プラットフォームが新しいトークン標準をサポートすることなく、大量の非代替性トークンの所有権を特定できるようになります。NFTの一括作成および転送には様々な実装方法がありますが、`ConsecutiveTransfer` 拡張により、すべての実装で使用できる標準化されたイベントを提供します。連続したトークン識別子の範囲を指定することで、2^(256)個のトークンの転送や作成をカバーでき、分散型プラットフォームはそれに応じて対応できます。

例えば、私は魔法の果物を販売しており、1万本の魔法の果樹園があり、数年ごとに1,000本の新しい樹木が植えられます。私はこれらの樹木を1つ1つ非代替性トークン化したいと考えています。各トークンの所有者は、その樹木からの四半期ごとの収穫の一部を受け取ることができます。しかし、これらのトークンを個別に作成および転送するには、多くの時間とコストがかかり、実現が難しくなります。

この拡張を使えば、初期の1万本の樹木トークンを1つのトランザクションでミントできます。新しい樹木が植えられた際の追加の1,000本のトークンも、素早く安価にミントできます。そして、売買と収益分配を管理する特別なスマートコントラクトに、これらの1万本以上のトークンを一括で転送することができ、指定された標準に準拠しながら実行できます。

**ミント、焼却、転送をカバーする単一のイベントの根拠**

`ConsecutiveTransfer` イベントは、ミント、焼却、転送イベントをカバーできます。初めは転送の "0" パターンに従うことで混乱があったかもしれませんが、`ConsecutiveTransfer` トピックを確認し、ERC-165 標準を使ってERC-721インターフェイスをサポートしているコントラクトであることを確認することで、これは軽減されます。

**インデックス付きイベントパラメーター**

Solidityのイベントには最大3つのインデックス付きパラメーターを設定できるため、インデックス付き引数の特定の値でフィルタリングできます。この標準では、`fromAddress`、`toAddress`、`fromTokenId` をインデックス付きパラメーターに設定しています。`toTokenId` はログのデータ部分から取得できます。これは、ほとんどの場合、あるアドレスの所有権の履歴を調べたいためです。`fromTokenId` を他の2つのインデックス付きパラメーターとともに取得できるため、シンプルになります。その後、ログデータをデコードして `toTokenId` を取得するだけです。

**`ConsecutiveTransfer` を発行する際に `Transfer` を発行しない根拠**

これにより、これらのイベントを使ってトークンの所有権を追跡するプラットフォームでバグが発生したり、複雑なロジックが必要になる可能性があります。単一のトークンを転送する場合は、元の `Transfer` イベントを発行してもかまいませんが、同じトランザクション内で `ConsecutiveTransfer` イベントを発行してはなりません。その逆も同様です。

**2309 と 1155 の比較**

NFTマーケットが成長し続けるにつれ、スケーラブルなスマートコントラクトを構築する必要性が高まっています。ユーザーは一度に大量のトークンをミントしたり、大量のトークンを転送したり、これらのアセットの所有権を追跡したりできる必要があります。これらを、Ethereumブロックチェーンの制約の中で、コストパフォーマンスよく実現する必要があります。数百万ものトークンがミントされる中で、スケーラブルなコントラクトが必要とされています。

[ERC-1155](./eip-1155.md)は2019年に標準として追加され、これらの問題を解決しようとしましたが、大量の固有のトークンを効率的にミントする点では不足しています。ERC-1155では、数百ドル(または数千ドル)のコストがかかるか、ガス代を使い果たしてしまいます。ERC-1155は、多数の半代替性トークンのミントには適していますが、多数の固有のトークンのミントには不向きです。2309 標準を使えば、事前に数百万の空のNFTをミントし、それぞれのメタデータを効率的に更新することができます。


## 下位互換性

この拡張は、大量のトークンの作成、転送、削除の追跡メカニズムを提供するために、可能な限り小さな変更を加えるように設計されています。しかし、この変更は、元の `Transfer` イベントのみを使ってトークンの所有権を索引化しているプラットフォームに大きな影響を与える可能性があります。これらのプラットフォームでは、`ConsecutiveTransfer` イベントを監視することで得られる所有権情報を適切に記録できません。`ConsecutiveTransfer` イベントをサポートするプラットフォームでは、トークンの所有権を追跡するために、元の `Transfer` イベントと `ConsecutiveTransfer` イベントの両方をサポートするのが最善です。

## セキュリティ上の考慮事項
この標準の実装に直接関連するセキュリティ上の考慮事項はありません。

## 著作権

著作権およびそれに関連する権利は[CC0](../LICENSE.md)により放棄されています。