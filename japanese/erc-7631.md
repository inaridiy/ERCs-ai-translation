---
original: ddc7cde69c0cb732d0ade877b85486a796b13023937ce751f1543c6c53299a1c
---

---
eip: 7631
title: デュアルネイチャートークンペア
description: 共連結された可変性トークンと不可変性トークンのペアの仕様
author: vectorized (@vectorized), Thomas (@0xth0mas), Quit (@quitcrypto), Michael Amadi (@AmadiMichael), cygaar (@cygaar), Harrison (@pop-punk)
discussions-to: https://ethereum-magicians.org/t/erc-7631-dual-nature-token-pair/18796
status: レビュー
type: Standards Track
category: ERC
created: 2024-02-21
requires: 20, 721
---

## 概要

[ERC-20](./eip-20.md)可変性トークンコントラクトと[ERC-721](./eip-721.md)不可変性トークンコントラクトを相互に連結することで、一方のコントラクトで行われた操作が他方のコントラクトに反映されるようにできます。この提案では、2つのトークンコントラクト間の関係を照会する方法を定義します。また、ERC-20からERC-721への同期中にERC-721のミントやトランスファーをスキップするかどうかを、アカウントが設定できるようにします。

## 動機

ERC-20可変性トークンとERC-721不可変性トークンの標準は、共連結されたデュアルネイチャートークンペアに十分な柔軟性を提供します。ERC-20トークンの転送がERC-721トークンの転送をトリガーし、その逆も可能です。これにより、ERC-721トークンの分割化など、さまざまなアプリケーションが実現できます。

デュアルネイチャートークンペアは、ERC-20およびERC-721トークン標準の完全な準拠を維持します。この提案は、デュアルネイチャートークンペアの機能を強化することを目的としています。

トークン間の関係を照会するために、ERC-20およびERC-721トークンにそれぞれ拡張インターフェイスが提案されています。これにより、分散型取引所やNFTマーケットプレイスがトークン間の関係を表示するなど、さまざまな機能の改善が可能になります。

さらに、ユーザーはERC-20からERC-721への同期中にERC-721のミントやトランスファーをスキップするかどうかを設定できます。

## 仕様

この文書における「MUST」、「MUST NOT」、「REQUIRED」、「SHALL」、「SHALL NOT」、「SHOULD」、「SHOULD NOT」、「RECOMMENDED」、「NOT RECOMMENDED」、「MAY」、「OPTIONAL」のキーワードは、RFC 2119およびRFC 8174に記載されている通り解釈されるものとします。

### 概要

デュアルネイチャートークンペアは、ERC-20コントラクトとERC-721コントラクトで構成されます。

慣例として、ERC-20コントラクトをベースコントラクト、ERC-721コントラクトをミラーコントラクトと呼びます。

### ERC-20拡張インターフェイス

ERC-20コントラクトは、以下のインターフェイスを実装しなければなりません。

```solidity
interface IERC7631Base {
    /// @dev ミラーERC-721コントラクトのアドレスを返します。
    ///
    /// このメソッドはリバートするか、ミラーERC-721コントラクトがリンクされていないことを示すためにゼロアドレスを返す可能性があります。
    ///
    /// 非ゼロアドレスが返された場合、その返されたアドレスは`IERC7631Mirror`を実装しており、その`baseERC20()`メソッドはこのコントラクトのアドレスを返さなければなりません。
    ///
    /// 一度非ゼロアドレスが返されると、このメソッドはリバートしてはならず、返される値も変更されてはいけません。
    function mirrorERC721() external view returns (address);
}
```

ERC-20コントラクトは、以下のインターフェイスを実装してもよいです。

```solidity
interface IERC7631BaseNFTSkippable {
    /// @dev `owner`のスキップNFTステータスが`status`に更新されたときに、この
    /// イベントを発行すべきです。
    ///
    /// このイベントの目的は、スキップNFTステータスが変更されたことをインデクサーに通知することです。
    ///
    /// 実装の簡単さのために、ステータスが変更されていない場合でも、このイベントを発行してもかまいません。
    event SkipNFTSet(address indexed owner, bool status);

    /// @dev `owner`に対してERC-20からERC-721への同期中にERC-721のミントとトランスファーをスキップすべきかどうかを返します。
    /// そうでない場合はfalseを返します。
    ///
    /// このメソッドはリバートする可能性があります
    /// (例: コントラクトが初期化されていない、メソッドがサポートされていない)。
    ///
    /// このメソッドがリバートした場合:
    /// - 相互作用するコードは`setSkipNFT`機能が利用できないと解釈し、`setSkipNFT`を呼び出す機能を非表示にすべきです。
    /// - `owner`のスキップNFTステータスは未定義と解釈されるべきです。
    ///
    /// 一度ある`owner`に対して真偽値が返された後は、そのオーナーに対してこのメソッドがリバートしてはいけません。
    function getSkipNFT(address owner) external view returns (bool);

    /// @dev 呼び出し元のスキップNFTステータスを設定します。
    ///
    /// このメソッドはリバートする可能性があります
    /// (例: 権限不足、メソッドがサポートされていない)。
    ///
    /// このメソッドをパーミッションレスに保つことが推奨されます。
    ///
    /// {SkipNFTSet}イベントを発行します。
    function setSkipNFT(bool status) external;
}
```

### ERC-721拡張インターフェイス

ERC-721コントラクトは、以下のインターフェイスを実装しなければなりません。

```solidity
interface IERC7631Mirror {
    /// @dev ベースERC-20コントラクトのアドレスを返します。
    ///
    /// このメソッドはリバートするか、ベースERC-20コントラクトがリンクされていないことを示すためにゼロアドレスを返す可能性があります。
    ///
    /// 非ゼロアドレスが返された場合、その返されたアドレスは`IERC7631Base`を実装しており、その`mirrorERC721()`メソッドはこのコントラクトのアドレスを返さなければなりません。
    ///
    /// 一度非ゼロアドレスが返されると、このメソッドはリバートしてはならず、返される値も変更されてはいけません。
    function baseERC20() external view returns (address);
}
```

## 根拠

### 実装検出

`mirrorERC721`および`baseERC20`メソッドが非ゼロアドレスを返すことで、ERC-20およびERC-721コントラクトがそれぞれ必要なインターフェイスを実装していることが示されます。したがって、[ERC-165](./eip-165.md)は必要ありません。

`getSkipNFT`および`setSkipNFT`メソッドはリバートする可能性があります。SolidityまたはVyperでコンパイルされたコントラクトは、定義されていないメソッドへの呼び出しで本来リバートするため、明示的な`getSkipNFT`および`setSkipNFT`定義のない典型的な`IERC7631Base`実装でも、`IERC7631BaseNFTSkippable`に準拠します。

### NFTスキップ

スキップNFTメソッドにより、アカウントはERC-20転送時にERC-721トークンが自動的にミントされるのを避けることができます。

以下のような状況で役立ちます:

- 多数のユーザーに対してベスティングされるERC-20トークンを大量にロードするベスティングコントラクトの場合。
- 顧客にERC-721トークンを販売するためにERC-20トークンを大量にロードするキャンディマシンコントラクトの場合。
- 流動性プールにERC-20トークンを大量に転送する/転送出する場合。
- 管理者アカウント間でERC-20トークンを大量に転送する場合。

スキップNFTメソッドを標準に含めることで以下のことが可能になります:
- アプリケーションがユーザーにNFTをスキップするオプションを表示できるようになる。
- アプリケーションが、ブロックガスリミットを超える可能性のある複数のERC-721トークンのミントに関連するO(n)ガスコストなしに、任意の量のERC-20トークンを転送できるようになる。

ガス代が低いEVMチェーンでも、一括自動ERC-721転送がブロックガスリミットを超える可能性があるため、これらのメソッドは推奨されます。

`getSkipNFT`がデフォルトでスマートコントラクトの`owner`に対してtrueを返すのが有用なパターンです。

`getSkipNFT`がブール値を返すことを選択したのは、単純化のためです。より複雑な動作が必要な場合は、開発者が独自のメソッドを追加することができます。

### 実装規約

ERC-20コントラクトをベースコントラクトと呼ぶのは、一般的な実装ではERC-20残高からERC-721残高を容易に導出できるためです。これは、必要に応じてほとんどの論理をERC-721コントラクトに実装することを禁止するものではありません。

この提案では、トークンの同期ロジックは扱いません。これは、さまざまな実装パターンや新しいユースケース(自動的にリベースされるトークンなど)に柔軟性を持たせるためです。

### リンクメカニズム

リンクプロセスは柔軟性を確保するために省略されています。開発者は、コンストラクタ、イニシャライザ、またはカスタムの管理者専用パブリックメソッドを介して、任意のメカニズムを使用できます。唯一の制限は、ペアリングが確立された後は不変でなければならないということです(インデックス作成ロジックを簡素化するため)。

## 下位互換性

下位互換性の問題はありません。

## セキュリティ上の考慮事項

### 同期アクセスガード

同期ロジックの外部メソッドは、他のコントラクトのみが呼び出せるように保護されなければなりません。

### 稀少NFTのスナイピング

ERC-721トークンの希少性レベルが異なるデュアルネイチャーコレクションの場合、メタデータの露出は、メタデータのスクレイピングとERC-20トークンの転送によるゲーミングが容易にできないように行う必要があります。ERC-721トークンを一定期間同じアカウントで保持する必要があるという推奨事項があります。

### ガス切れによる拒否サービス攻撃

ERC-20トークンの転送は、複数のERC-721トークンのミント、転送、または焼却を自動的に開始する可能性があります。これにより、通常のERC-20トークン転送のO(1)ガスコストではなくO(n)ガスコストが発生する可能性があります。ERC-721トークンIDの選択ロジックにも追加のガスコストが発生する可能性があります。同期ロジックは、ERC-721関連のガスコストを考慮して、ガス切れによる拒否サービス攻撃を防ぐ必要があります。

## 著作権

著作権およびそれに関連する権利は[CC0](../LICENSE.md)によって放棄されています。