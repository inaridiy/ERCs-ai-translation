---
original: bb6a6fcc0f626e893bb22ee9465424101cc94b66846e9e74956b21b3e5a71fa1
---

---
eip: 5719
title: 署名置換インターフェース
description: 設定変更によりスタールになったスマートコントラクトウォレットの署名を非対話的に置換する。
author: Agustin Aguilar (@Agusx1211)
discussions-to: https://ethereum-magicians.org/t/erc-signature-replacing-for-smart-contract-wallets/11059
status: 停滞
type: Standards Track
category: ERC
created: 2022-09-26
requires: 1271
---

## 概要

スマートコントラクトウォレットの署名付きメッセージはスタールになる可能性があり、有効だった署名が無効になる可能性がある。

以下の理由で署名がスタールになる可能性がある:

* 内部の署名者セットが変更された
* ウォレットが署名の有効期限を設定している
* コントラクトが新しい実装に更新された

このスタンダードでは、スマートコントラクトウォレットがクライアントが使用できるURIを公開し、スタールになった署名を有効な署名に置換できるようにする。

## 動機

EOA署名とは対照的に、[EIP-1271](./eip-1271.md)の署名は必ずしも冪等ではなく、いつでも無効になる可能性がある。これは長期にわたって有効な署名に依存するプロトコルにとって課題となる。

以下のシナリオのいずれかが発生した場合、署名を変更する必要がある可能性がある:

1. ウォレットが、元のメッセージに署名した署名者を削除した。
2. ウォレットがMerkleツリーを使用して署名者を保存し、新しい署名者を追加した。
3. ウォレットがMerkleツリーを使用して署名を保存し、新しい署名を追加した。
4. ウォレットが新しい実装に更新され、署名スキーマが変更された。

署名の発行元のウォレットが署名の検証時に利用できない可能性があるため、非対話的な署名の置換が可能であるべきである。オフチェーンの注文書を使用する取引所での決済がその例である。

## 仕様

ウォレットコントラクトは以下の関数を実装しなければならない:

```solidity
function getAlternativeSignature(bytes32 _digest) external view returns (string);
```

返される文字列は、以下のスキーマを持つJSONオブジェクトを指すURIでなければならない:

```json
{
    "title": "Signature alternative",
    "type": "object",
    "properties": {
        "blockHash": {
            "type": "string",
            "description": "署名が有効であるべきblock.hash。"
        },
        "signature": {
            "type": "string",
            "description": "指定されたdigestの代替署名。"
        }
    }
}
```

### 署名の置換プロセス

クライアントは、署名を保持し、オフチェーンまたはオンチェーンで検証しようとするエンティティである。スマートコントラクトウォレットの署名を使用するには、クライアントは以下のアクションを実行しなければならない:

1) [EIP-1271](./eip-1271.md)を使用して署名の検証を試みる。署名が有効な場合、そのままの署名を使用できる。
2) 署名が無効な場合、`getAlternativeSignature(_digest)`を呼び出し、古い署名に対応する`digest`を渡す。
3) 呼び出しが失敗した場合、URIが返されない場合、またはURIの内容が有効でない場合、その署名は無効と見なされなければならない。
4) [EIP-1271](./eip-1271.md)を使用して新しい署名の検証を試みる。署名が有効な場合、それを元の署名の代替として使用できる。
5) 検証に失敗した場合、ステップ(2)から繰り返す(注意: URIが同じ署名を返す場合、その署名は無効と見なされなければならない)。

クライアントは、代替署名の取得時にリトライ制限を実装しなければならない。このリミットはクライアントが定義する。

## 根拠

URIを選択した理由は、集中型および分散型のソリューションに対応できるためである。例えば、サーバーがMerkleプルーフの実時間再エンコーディングを実装したり、IPFSリンクがすべての事前計算された署名変更を指すディレクトリを指すことができる。

`getAlternativeSignature`メソッドがオフチェーンのソースを指すのは、スマートコントラクトウォレットがすべての署名済みdigestのオンチェーンレコードを保持していないことが期待されるためである。そうでない場合、そのようなコントラクトはこのEIPを使用する必要がなく、`isValidSignature`で`digest`を直接検証できる。

## 下位互換性

`getAlternativeSignature`メソッドを実装していない既存のウォレットは、変更なしにメッセージに署名できる。署名が無効になった場合、クライアントはステップ(3)でそれらを破棄する。

## セキュリティ上の考慮事項

一部のアプリケーションでは署名をシークレットとして使用しているが、このEIPが署名を公開すると、そのようなシークレットが漏洩する可能性がある。

## 著作権

著作権およびそれに関連する権利は[CC0](../LICENSE.md)で放棄されています。