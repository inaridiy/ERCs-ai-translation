---
original: 9ee147b1e9f2c91495cda5fee22c601875cd879e1bebe6b5a35922af4513c001
---

---
eip: 6735
title: EVM ベースのアドレスの L2 エイリアシング
description: 異なる Layer 1、Layer 2、またはサイドチェーンからの EVM ベースのアドレスを識別し、翻訳する
author: Kelvin Fichter (@smartcontracts)、Andreas Freund (@Therecanbeonlyone1969)
discussions-to: https://ethereum-magicians.org/t/l2-aliasing-of-evm-based-addresses-from-the-eea-oasis-community-projects-l2-standards-working-group/13093
status: Draft
type: Standards Track
category: ERC
created: 2022-03-20
requires: 55
---

## 概要

このドキュメントでは、EVM ベースのアドレスのエイリアシングのための最小限の事業および技術的前提条件、機能的および非機能的要件を説明します。これらの要件を実装すると、2つ以上のLayer 1、Layer 2、またはサイドチェーンが、異なるLayer 1、Layer 2、またはサイドチェーンからのEVMベースのアドレスを識別し、翻訳できるようになります。

## 動機

EEA コミュニティ プロジェクトの L2 WG (OASIS 管理) のメンバーは、EVM ベースの実行フレームワークの L1、L2、サイドチェーンにおける、デジタル資産または外部所有アカウント (EOA) のアドレスを決定論的に導出する機能(アドレスエイリアシング)が、EVM ベースのL1、L2、サイドチェーン間の相互運用性を簡素化することを認識しています:

* これにより、チェーン A (ソースチェーン) からのメッセージを、資産 A (スマートコントラクト) または EOA がチェーン X とチェーン Y の両方に存在する場合、チェーン Y (ターゲットチェーン) で明確に指定できます。
* これにより、ユーザーがメッセージのソースチェーンを決定論的に検証し、必要に応じて、(メッセージ) ソースチェーンのカノニカルトークンリストを利用して、資産 A または EOA の発信元チェーンとその状態を直接検証できます。

デジタル資産 (スマートコントラクト) または外部所有アカウント (EOA) のアドレスを、これらが存在する EVM ベースのL1、L2、サイドチェーン間で明確かつ決定論的に関連付けることができる機能(アドレスエイリアシング)は、EVM ベースのL1、L2、サイドチェーン間の相互運用性にとって重要な前提条件です。しかし、現在、標準化された方法はありません - 想像してみてください、インターネットサービスプロバイダーがそれぞれ独自のIPアドレスを定義しているとしたら。

したがって、EEA コミュニティ プロジェクトの L2 WG (OASIS 管理)は、オープンソースのイニシアチブとして、このドキュメントで、ルート→リーフの概念に基づいた、EVM ベースのアドレスエイリアシングの明確で決定論的な標準を確立することを意図しています。アドレスエイリアスは、発信元チェーンのアドレスとオフセットに基づいて導出されます。オフセットは発信元チェーンの不変の特性です。

図1に、オフセットを使用したルート→リーフのアドレスエイリアシングの概念的な設計を示します。

![Fig1](../assets/eip-6735/address-aliasing-root-leaf-design.png)

図1: L1からL2、L3、そして逆方向へのアドレスエイリアシングの概念。チェーン固有の特性を使用したルート→リーフデザイン。

代替図1の説明: この図は、ソースチェーンからターゲットチェーンへのメッセージ(相互運用性)がアドレスエイリアシングを利用する方法を概念的に説明しています。下部にEVMベースのL1があり、3つのEVMベースのL2 - A、B、Cに一方向に接続されています。各L2には、L1アドレス + L1オフセットのエイリアスがあります。さらに、AはBに一方向に接続されており、L1アドレス + L1オフセット + Aオフセットのエイリアスを持っています。BはEVMベースのLayer 3またはL3に一方向に接続されており、L1アドレス + L1オフセット + Bオフセットのエイリアスを持っています。これは、アセットがL1からL2 Bを経由していることを示しています。最後に、DはCに一方向に接続されており、L1アドレス + L1オフセット + Bオフセット + Dオフセットのエイリアスを持っています。これは、アセットの所有権がL1からL2 Bを経由してL3 Dに至り、最終的にL2 Cに至ることを示しています。

EVM ベースのL1からL2 B、L3 D、最終的にL2 Cへの経路を視覚的に強調するために、赤色で強調表示しています。

![Fig2](../assets/eip-6735/visual-Highlight-Path-Red-evm-based-aliasing..png)

図2: EVM ベースのL1からL2 B、L3 D、最終的にL2 Cへの経路を赤色で強調表示。

代替図1の説明: この図は図1と同じですが、EVM ベースのL1からL2 B、L3 D、最終的にL2 Cへの一方向の接続が赤色で強調表示されています。

なお、EVM以外のL1、L2、サイドチェーンとEVMベースのL1、L2、サイドチェーン間、およびEVM以外のL1、L2、サイドチェーン間のアドレスエイリアシングは、このドキュメントの範囲外です。

## 仕様

### 表記規則: 要件 ID

要件は、要件レベルに続いて要件番号で構成される一意の ID によって一意に識別されます。この規則は **[RequirementLevelRequirementNumber]** に従います。

要件レベルは以下の4つがあり、要件 ID に次のように表記されます:

**[R]** - _R_ で始まる要件 ID は、[RFC2119](https://www.rfc-editor.org/rfc/rfc2119)で説明されている **MUST** として解釈されます。\
**[D]** - _D_ で始まる要件 ID は、[RFC2119](https://www.rfc-editor.org/rfc/rfc2119)で説明されている **SHOULD** として解釈されます。\
**[O]** - _O_ で始まる要件 ID は、[RFC2119](https://www.rfc-editor.org/rfc/rfc2119)で説明されている **MAY** として解釈されます。

要件は各要件レベル内で昇順に一意に番号付けされています。

例: [R1] は仕様の絶対的な要件と解釈され、[D1] は推奨事項、[O1] は完全にオプションです。

以下の要件は、EVM ベースのL1、L2、またはサイドチェーンにのみ有効です。非EVMシステムのアドレスエイリアシングは、このドキュメントの範囲外です。

<a name="r1"> **[R1]** </a>
チェーン A とチェーン B の間で使用されるアドレスエイリアス - `addressAlias` - は、次のように構築されなければなりません:
`addressAlias (Chain A) = offsetAlias (for Chain A) relativeAddress (on Chain A) offsetAlias (for Chain A)`

[[R1]](#r1) の検証可能性: `addressAlias` は既存のオープンソースパッケージを使用して解析およびスプリットでき、構築に使用された既知の `addressAlias` および `relativeAddress` と結果を比較できます。

<a name="r2"> **[R2]** </a>
チェーンの `offsetAlias` は `0xchainId00000000000000000000000000000000chainId` でなければなりません。

[[R2]](#r2) の検証可能性: `offsetAlias` は既存のオープンソースパッケージを使用して解析およびスプリットでき、構築に使用された既知の `chainId` と結果を比較できます。

<a name="r3"> **[R3]** </a>
`offsetAlias` に使用される `chainId` はゼロ (0) であってはなりません。

[[R3]](#r3) の検証可能性: `chainId` は数値値であり、`0` と比較できます。

<a name="r4"> **[R4]** </a>
`offsetAlias` に使用される `chainId` は8バイトでなければなりません。

[[R4]](#r4) の検証可能性: `chainId` の文字列の長さをバイトに変換し、`8` と比較できます。

<a name="r5"> **[R5]** </a>
`chainId` が16桁未満の場合、`chainId` は16桁になるようにゼロで埋める必要があります。

例えば、Polygon PoS の `chainId` は `137` で、現在の EVM ベースの `chainId` のリストは chainlist.org で確認できます。その `offsetAlias` は `0x0000000000000137000000000000000000000000000000000000000000000137` です。

[[R5]](#r5) の検証可能性: `chainId` は既存のオープンソースパッケージを使用して解析およびスプリットでき、構築に使用された既知の `chainId` と結果を比較できます。その後、パディングに使用されるゼロの数を計算し、期待されるゼロの数と比較できます。

<a name="r6"> **[R6]** </a>
EVM ベースのチェーンの主要なアンカーであるイーサリアムメインネットの `offsetAlias` は、既存のL2ソリューションによる現在の採用により、`0x1111000000000000000000000000000000001111` でなければなりません。

USDCアセットのアドレスエイリアスの例は `addressAlias = 0x1111A0b86991c6218b36c1d19D4a2e9Eb0cE3606eB481111` です。

[[R6]](#r6) の検証可能性: この要件は [[R1]](#r1) の特殊ケースです。したがって、検証可能です。

<a name="r7"> **[R7]** </a>
外部所有アカウント (EOA) またはスマートコントラクトの `relativeAddress` は、発信元チェーンのスマートコントラクトまたはEOAアドレス、または別のチェーンからのEOAまたはスマートコントラクトの `relativeAddress` でなければなりません。

前者の例は、ラップドUSDCの相対アドレス `relativeAddress = 0x1111A0b86991c6218b36c1d19D4a2e9Eb0cE3606eB481111` で、後者の例は、PolygonのラップドUSDCの相対アドレス `relativeAddress = 0x00000000000001371111A0b86991c6218b36c1d19D4a2e9Eb0cE3606eB4811110000000000000137` です。

最後に、イーサリアムからArbitrumへのラップドUSDCのメッセージのアドレスエイリアスの例は次のようになります:

```
addressAlias = 0x00000000000421611111A0b86991c6218b36c1d19D4a2e9Eb0cE3606eB4811110000000000042161
```

[[R7]](#r7) の検証可能性: このドキュメントはEVMベースのシステムを扱っており、複数の実稼働実装があるため、アドレスがEOAまたはスマートコントラクトに属するかどうかを検証する既知の方法が複数あります。

<a name="r8"> **[R8]** </a>
`addressAlias` 内の `offsetAlias` の順序は、ルートチェーンの `offSetAlias` から始まり、ルートチェーンの `relativeAddress` を囲む順序で、そのデジタルアセットが存在するチェーンの `offsetAlias` が続く必要があります。

例えば、チェーン A からチェーン B に、さらにチェーン C に橋渡しされたアセットのvalid な `addressAlias` は次のようになります:

```
addressAlias = chainId(C) chainId(B) chainId(A) relativeAddress chainId(A) chainId(B) chainId(C)
```   

一方、逆順は無効です:

```
addressAlias = chainId(A) chainId(B) chainId(C) relativeAddress chainId(C) chainId(B) chainId(A)
```  

[[R8]](#r8) の検証可能性: [[R1]](#r1) は検証可能であり、[[R8]](#r8) は [[R1]](#r1) の構築の順序規則であるため、[[R1]](#r1) のテストの出力に論理演算を適用することで検証できます。

ただし、特定の順序が確実に正しいことを証明することは、このドキュメントの範囲外です。

### 適合性

このセクションでは、このドキュメントの要件に適合
### 適合性

このセクションでは、このドキュメントの要件に適合するための適合性条項とテストについて説明します。

#### 適合性ターゲット

このドキュメントでは、まだ標準化されたテストフィクスチャーとテスト入力を定義していません。

標準化されたテストフィクスチャーとテスト入力は、次のバージョンの標準で公開される予定です。

#### 適合性レベル

このセクションでは、このEVMベースのアドレスエイリアシングの適合性レベルを定義します。適合性レベルにより、実装者は競争力のある差別化を行うことができます。

このドキュメントでは、EVM ベースのアドレスエイリアシングの適合性レベルを次のように定義しています:

* **レベル1:** 実装固有のテストフィクスチャーとテスト入力に基づいて、各要件への適合性を明確に示すテストレポートによって、MUST要件がすべて満たされていることが証明されている。
* **レベル2:** 実装固有のテストフィクスチャーとテスト入力に基づいて、各要件への適合性を明確に示すテストレポートによって、MUST要件とSHOULD要件がすべて満たされていることが証明されている。
* **レベル3:** 実装固有のテストフィクスチャーとテスト入力に基づいて、各要件への適合性を明確に示すテストレポートによって、MUST要件、SHOULD要件、および条件付きMUSTまたはSHOULD要件のMAY要件がすべて満たされていることが証明されている。

<a name="d1"> **[D1]** </a>
カノニカルトークンリストの実装がこの仕様に適合していると主張する場合、各要件について実施したテスト手順を記述し、その要件に対する適合性を正当化する必要があります。

[[D1]](#d1) の検証可能性: このドキュメントの非適合性ターゲット要件はすべて検証可能であるため、このドキュメントの要件全体も検証可能でなければなりません。したがって、すべての要件に対する適合性テストを記述することができ、[[D1]](#d1)で要求されているように記述する必要があります。

<a name="r9"> **[R9]** </a>
カノニカルトークンリストの実装が **レベル2** 以上でこの仕様に適合していると主張する場合、**レベル2** 以上の各要件について実施したテスト手順を記述し、その要件に対する適合性を正当化する必要があります。

[[R9]](#r9) の検証可能性: このドキュメントの非適合性ターゲット要件はすべて検証可能であるため、このドキュメントの要件全体も検証可能でなければなりません。したがって、すべての要件に対する適合性テストを記述、構築、実装し、その結果を記録することができ、[[R9]](#r9)で要求されているように記述する必要があります。

## 根拠

この標準は、イーサリアム(L1)からEVM ベースのL2 (Arbitrum、Optimism など)への、およびL2間のアドレスエイリアシングのための既存のアプローチに従っており、EVM ベースのネットワーク (L1、L2、またはより高いレイヤー) 間のエイリアシングを可能にするように拡張および一般化しています。

## セキュリティ上の考慮事項

### データプライバシー

この標準は、法的規制への準拠に関する要件を定めていません。実装者は適用される個人情報保護法を遵守する責任があります。

### 本番環境での準備

この標準は、特定のアプリケーション/ツール/ライブラリなどの使用に関する要件を定めていません。実装者は、特定のアプリケーション/ツール/ライブラリを選択する際に、十分な注意を払う必要があります。

`relativeAddress` の構築に使用されるイーサリアムタイプのアドレスには、セキュリティ上の考慮事項があります。

`relativeAddress` で使用されるイーサリアムタイプのアドレスが EOA であると想定される場合、ターゲットシステム/受信者は、悪意のあるコードが不正に実行されないよう、ソースアカウントの `codehash` が `NULL` であることを検証する必要があります。

`relativeAddress` で使用されるイーサリアムタイプのアドレスがアセットを表すスマートコントラクトアカウントであると想定される場合、ターゲットシステム/受信者は、ソースアカウントの `codehash` が公開されたスマートコントラクトのソリディティコードの `codehash` と一致することを検証し、ソースのスマートコントラクトが期待どおりに動作することを確認する必要があります。

最後に、`relativeAddress` の検証の一環として、ターゲットシステムが [ERC-55](./eip-55.md) で定義されているアドレスチェックサムの検証を行うことをお勧めします。

### 国際化とローカリゼーション

EVM ベースのアドレスエイリアシングには言語依存の機能がないため、国際化/ローカリゼーションの考慮事項はありません。

## 著作権

著作権およびその関連権利は [CC0](../LICENSE.md) で放棄されています。